/*! For license information please see diva.js.LICENSE.txt */
(()=>{var e={227:function(e,t,i){"use strict";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.log=function(){var e;return("undefined"==typeof console?"undefined":s(console))==="object"&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var i="color: "+this.color;t.splice(1,0,i,"color: inherit");var s=0,o=0;t[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(s++,"%c"===e&&(o=s))}),t.splice(o,0,i)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return"undefined"!=typeof window&&!!window.process&&("renderer"===window.process.type||!!window.process.__nwjs)||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=i(447)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},447:function(e,t,i){"use strict";e.exports=function(e){function t(e){for(var t=0,i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i)|0;return s.colors[Math.abs(t)%s.colors.length]}function s(e){var i;function r(){if(r.enabled){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];var n=Number(new Date),a=n-(i||n);r.diff=a,r.prev=i,r.curr=n,i=n,t[0]=s.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var l=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,function(e,i){if("%%"===e)return e;l++;var o=s.formatters[i];if("function"==typeof o){var n=t[l];e=o.call(r,n),t.splice(l,1),l--}return e}),s.formatArgs.call(r,t),(r.log||s.log).apply(r,t)}}return r.namespace=e,r.enabled=s.enabled(e),r.useColors=s.useColors(),r.color=t(e),r.destroy=o,r.extend=n,"function"==typeof s.init&&s.init(r),s.instances.push(r),r}function o(){var e=s.instances.indexOf(this);return -1!==e&&(s.instances.splice(e,1),!0)}function n(e,t){return s(this.namespace+(void 0===t?":":t)+e)}return s.debug=s,s.default=s,s.coerce=function(e){return e instanceof Error?e.stack||e.message:e},s.disable=function(){s.enable("")},s.enable=function(e){s.save(e),s.names=[],s.skips=[];var t,i=("string"==typeof e?e:"").split(/[\s,]+/),o=i.length;for(t=0;t<o;t++)i[t]&&("-"===(e=i[t].replace(/\*/g,".*?"))[0]?s.skips.push(RegExp("^"+e.substr(1)+"$")):s.names.push(RegExp("^"+e+"$")));for(t=0;t<s.instances.length;t++){var n=s.instances[t];n.enabled=s.enabled(n.namespace)}},s.enabled=function(e){var t,i;if("*"===e[e.length-1])return!0;for(t=0,i=s.skips.length;t<i;t++)if(s.skips[t].test(e))return!1;for(t=0,i=s.names.length;t<i;t++)if(s.names[t].test(e))return!0;return!1},s.humanize=i(824),Object.keys(e).forEach(function(t){s[t]=e[t]}),s.instances=[],s.names=[],s.skips=[],s.formatters={},s.selectColor=t,s.enable(s.load()),s}},824:function(e){function t(e,t,i,s){return Math.round(e/i)+" "+s+(t>=1.5*i?"s":"")}e.exports=function(e,i){i=i||{};var s,o,n,r,a=typeof e;if("string"===a&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var i=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return 864e5*i;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*i;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*i;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}(e);if("number"===a&&isFinite(e)){return i.long?(o=Math.abs(s=e))>=864e5?t(s,o,864e5,"day"):o>=36e5?t(s,o,36e5,"hour"):o>=6e4?t(s,o,6e4,"minute"):o>=1e3?t(s,o,1e3,"second"):s+" ms":(r=Math.abs(n=e))>=864e5?Math.round(n/864e5)+"d":r>=36e5?Math.round(n/36e5)+"h":r>=6e4?Math.round(n/6e4)+"m":r>=1e3?Math.round(n/1e3)+"s":n+"ms"}throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},838:function(e,t){var i;i=function(e){var t,i,s=window,o=document,n="mousemove",r="mouseup",a="mousedown",l="EventListener",h="add"+l,c="remove"+l,d=[],g=function(e,l){for(e=0;e<d.length;)(l=(l=d[e++]).container||l)[c](a,l.md,0),s[c](r,l.mu,0),s[c](n,l.mm,0);for(e=0,d=[].slice.call(o.getElementsByClassName("dragscroll"));e<d.length;)!function(e,l,c,d,g,u){(u=e.container||e)[h](a,u.md=function(t){e.hasAttribute("nochilddrag")&&o.elementFromPoint(t.pageX,t.pageY)!==u||(d=1,l=t.clientX,c=t.clientY,t.preventDefault())},0),s[h](r,u.mu=function(){d=0},0),s[h](n,u.mm=function(s){d&&((g=e.scroller||e).scrollLeft-=t=-l+(l=s.clientX),g.scrollTop-=i=-c+(c=s.clientY),e===o.body&&((g=o.documentElement).scrollLeft-=t,g.scrollTop-=i))},0)}(d[e++])};"complete"===o.readyState?g():s[h]("load",g,0),e.reset=g,window.resetDragscroll=g},"function"==typeof define&&define.amd?define(["exports"],i):i(t)},876:function(){var e,t,i,s;e=window.requestAnimationFrame,t="ontouchend"in document,i=function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]},(s=function(e,t){return this.settings=i({},s.DEFAULTS,t),this.el=e,this.ACTIVE_CLASS="kinetic-active",this._initElements(),this.el._VanillaKinetic=this,this}).DEFAULTS={cursor:"move",decelerate:!0,triggerHardware:!1,threshold:0,y:!0,x:!0,slowdown:.9,maxvelocity:40,throttleFPS:60,invert:!1,movingClass:{up:"kinetic-moving-up",down:"kinetic-moving-down",left:"kinetic-moving-left",right:"kinetic-moving-right"},deceleratingClass:{up:"kinetic-decelerating-up",down:"kinetic-decelerating-down",left:"kinetic-decelerating-left",right:"kinetic-decelerating-right"}},s.prototype.start=function(e){this.settings=i(this.settings,e),this.velocity=e.velocity||this.velocity,this.velocityY=e.velocityY||this.velocityY,this.settings.decelerate=!1,this._move()},s.prototype.end=function(){this.settings.decelerate=!0},s.prototype.stop=function(){this.velocity=0,this.velocityY=0,this.settings.decelerate=!0,"function"==typeof this.settings.stopped&&this.settings.stopped.call(this)},s.prototype.detach=function(){this._detachListeners(),this.el.classList.remove(this.ACTIVE_CLASS),this.el.style.cursor=""},s.prototype.attach=function(){!this.el.classList.contains(this.ACTIVE_CLASS)&&(this._attachListeners(),this.el.classList.add(this.ACTIVE_CLASS),this.el.style.cursor=this.settings.cursor)},s.prototype._initElements=function(){this.el.classList.add(this.ACTIVE_CLASS),i(this,{xpos:null,prevXPos:!1,ypos:null,prevYPos:!1,mouseDown:!1,throttleTimeout:1e3/this.settings.throttleFPS,lastMove:null,elementFocused:null}),this.velocity=0,this.velocityY=0;var e=this;this.documentResetHandler=function(){e._resetMouse.apply(e)};var t=document.documentElement;if(t.addEventListener("mouseup",this.documentResetHandler,!1),t.addEventListener("click",this.documentResetHandler,!1),this._initEvents(),this.el.style.cursor=this.settings.cursor,this.settings.triggerHardware)for(var s=["","-ms-","-webkit-","-moz-"],o={transform:"translate3d(0,0,0)",perspective:"1000","backface-visibility":"hidden"},n=0;n<s.length;n++){var r=s[n];for(var a in o)o.hasOwnProperty(a)&&(this.el.style[r+a]=o[a])}},s.prototype._initEvents=function(){var e=this;this.settings.events={touchStart:function(t){var i;e._useTarget(t.target,t)&&(i=t.originalEvent.touches[0],e.threshold=e._threshold(t.target,t),e._start(i.clientX,i.clientY),t.stopPropagation())},touchMove:function(t){var i;e.mouseDown&&(i=t.originalEvent.touches[0],e._inputmove(i.clientX,i.clientY),t.preventDefault&&t.preventDefault())},inputDown:function(t){e._useTarget(t.target,t)&&(e.threshold=e._threshold(t.target,t),e._start(t.clientX,t.clientY),e.elementFocused=t.target,"IMG"===t.target.nodeName&&t.preventDefault(),t.stopPropagation())},inputEnd:function(t){e._useTarget(t.target,t)&&(e._end(),e.elementFocused=null,t.preventDefault&&t.preventDefault())},inputMove:function(t){e.mouseDown&&(e._inputmove(t.clientX,t.clientY),t.preventDefault&&t.preventDefault())},scroll:function(t){"function"==typeof e.settings.moved&&e.settings.moved.call(e,e.settings),t.preventDefault&&t.preventDefault()},inputClick:function(t){if(Math.abs(e.velocity)>0||Math.abs(e.velocityY)>0)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),!1},dragStart:function(t){if(e._useTarget(t.target,t)&&e.elementFocused)return t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),!1},selectStart:function(t){return"function"==typeof e.settings.selectStart?e.settings.selectStart.apply(e,arguments):e._useTarget(t.target,t)?(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),!1):void 0}},this._attachListeners()},s.prototype._inputmove=function(e,t){if((!this.lastMove||new Date>new Date(this.lastMove.getTime()+this.throttleTimeout))&&(this.lastMove=new Date,this.mouseDown&&(this.xpos||this.ypos))){var i=e-this.xpos,s=t-this.ypos;if(this.settings.invert&&(i*=-1,s*=-1),this.threshold>0){var o=Math.sqrt(i*i+s*s);if(this.threshold>o)return;this.threshold=0}this.elementFocused&&(this.elementFocused.blur(),this.elementFocused=null,this.el.focus()),this.settings.decelerate=!1,this.velocity=this.velocityY=0;var n=this.scrollLeft(),r=this.scrollTop();this.scrollLeft(this.settings.x?n-i:n),this.scrollTop(this.settings.y?r-s:r),this.prevXPos=this.xpos,this.prevYPos=this.ypos,this.xpos=e,this.ypos=t,this._calculateVelocities(),this._setMoveClasses(this.settings.movingClass),"function"==typeof this.settings.moved&&this.settings.moved.call(this,this.settings)}},s.prototype._calculateVelocities=function(){this.velocity=this._capVelocity(this.prevXPos-this.xpos,this.settings.maxvelocity),this.velocityY=this._capVelocity(this.prevYPos-this.ypos,this.settings.maxvelocity),this.settings.invert&&(this.velocity*=-1,this.velocityY*=-1)},s.prototype._end=function(){this.xpos&&this.prevXPos&&!1===this.settings.decelerate&&(this.settings.decelerate=!0,this._calculateVelocities(),this.xpos=this.prevXPos=this.mouseDown=!1,this._move())},s.prototype._useTarget=function(e,t){return"function"!=typeof this.settings.filterTarget||!1!==this.settings.filterTarget.call(this,e,t)},s.prototype._threshold=function(e,t){return"function"==typeof this.settings.threshold?this.settings.threshold.call(this,e,t):this.settings.threshold},s.prototype._start=function(e,t){this.mouseDown=!0,this.velocity=this.prevXPos=0,this.velocityY=this.prevYPos=0,this.xpos=e,this.ypos=t},s.prototype._resetMouse=function(){this.xpos=!1,this.ypos=!1,this.mouseDown=!1},s.prototype._decelerateVelocity=function(e,t){return 0===Math.floor(Math.abs(e))?0:e*t},s.prototype._capVelocity=function(e,t){var i=e;return e>0?e>t&&(i=t):e<0-t&&(i=0-t),i},s.prototype._setMoveClasses=function(e){var t=this.settings,i=this.el;i.classList.remove(t.movingClass.up),i.classList.remove(t.movingClass.down),i.classList.remove(t.movingClass.left),i.classList.remove(t.movingClass.right),i.classList.remove(t.deceleratingClass.up),i.classList.remove(t.deceleratingClass.down),i.classList.remove(t.deceleratingClass.left),i.classList.remove(t.deceleratingClass.right),this.velocity>0&&i.classList.add(e.right),this.velocity<0&&i.classList.add(e.left),this.velocityY>0&&i.classList.add(e.down),this.velocityY<0&&i.classList.add(e.up)},s.prototype._move=function(){var t=this._getScroller(),i=this,s=this.settings;s.x&&t.scrollWidth>0?(this.scrollLeft(this.scrollLeft()+this.velocity),Math.abs(this.velocity)>0&&(this.velocity=s.decelerate?i._decelerateVelocity(this.velocity,s.slowdown):this.velocity)):this.velocity=0,s.y&&t.scrollHeight>0?(this.scrollTop(this.scrollTop()+this.velocityY),Math.abs(this.velocityY)>0&&(this.velocityY=s.decelerate?i._decelerateVelocity(this.velocityY,s.slowdown):this.velocityY)):this.velocityY=0,i._setMoveClasses(s.deceleratingClass),"function"==typeof s.moved&&s.moved.call(this,s),Math.abs(this.velocity)>0||Math.abs(this.velocityY)>0?this.moving||(this.moving=!0,e(function(){i.moving=!1,i._move()})):i.stop()},s.prototype._getScroller=function(){return this.el},s.prototype.scrollLeft=function(e){var t=this._getScroller();if("number"!=typeof e)return t.scrollLeft;t.scrollLeft=e,this.settings.scrollLeft=e},s.prototype.scrollTop=function(e){var t=this._getScroller();if("number"!=typeof e)return t.scrollTop;t.scrollTop=e,this.settings.scrollTop=e},s.prototype._attachListeners=function(){var e=this.el,i=this.settings;t&&(e.addEventListener("touchstart",i.events.touchStart,!1),e.addEventListener("touchend",i.events.inputEnd,!1),e.addEventListener("touchmove",i.events.touchMove,!1)),e.addEventListener("mousedown",i.events.inputDown,!1),e.addEventListener("mouseup",i.events.inputEnd,!1),e.addEventListener("mousemove",i.events.inputMove,!1),e.addEventListener("click",i.events.inputClick,!1),e.addEventListener("scroll",i.events.scroll,!1),e.addEventListener("selectstart",i.events.selectStart,!1),e.addEventListener("dragstart",i.events.dragStart,!1)},s.prototype._detachListeners=function(){var e=this.el,i=this.settings;t&&(e.removeEventListener("touchstart",i.events.touchStart,!1),e.removeEventListener("touchend",i.events.inputEnd,!1),e.removeEventListener("touchmove",i.events.touchMove,!1)),e.removeEventListener("mousedown",i.events.inputDown,!1),e.removeEventListener("mouseup",i.events.inputEnd,!1),e.removeEventListener("mousemove",i.events.inputMove,!1),e.removeEventListener("click",i.events.inputClick,!1),e.removeEventListener("scroll",i.events.scroll,!1),e.removeEventListener("selectstart",i.events.selectStart,!1),e.removeEventListener("dragstart",i.events.dragStart,!1)},window.VanillaKinetic=s}},t={};function i(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,i),n.exports}i.rv=()=>"1.2.8",i.ruid="bundler=rspack@1.2.8",(()=>{"use strict";function e(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function t(e){for(var t=arguments.length,i=Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];let n=document.createElement(e);for(;i.length;)!function e(t,i){if(null!=i){if("object"!=typeof i&&"function"!=typeof i)t.appendChild(document.createTextNode(i));else if(i instanceof window.Node)t.appendChild(i);else if(i instanceof Array){let s=i.length;for(let o=0;o<s;o++)e(t,i[o])}else s(t,i)}}(n,i.shift());return n}function s(e,t){for(let i in t)t.hasOwnProperty(i)&&("style"===i?function(e,t){if(t){if("object"!=typeof t){e.style.cssText=t;return}for(let i in t)t.hasOwnProperty(i)&&(e.style[i]=t[i])}}(e,t.style):e.setAttribute(i,t[i]))}function o(e){this.name="DivaParentElementNotFoundException",this.message=e,this.stack=Error().stack}function n(e){this.name="NotAnIIIFManifestException",this.message=e,this.stack=Error().stack}function r(e){this.name="ObjectDataNotSuppliedException",this.message=e,this.stack=Error().stack}i(876),i(838),o.prototype=Error(),n.prototype=Error(),r.prototype=Error();let a={Events:new class{publish(e,t,i){if(this._cache[e]){let s=this._cache[e];if(void 0!==s.global){let e=s.global,o=e.length;for(let s=0;s<o;s++)e[s].apply(i||null,t||[])}if(i&&void 0!==i.getInstanceId){let s=i.getInstanceId();if(this._cache[e][s]){let o=this._cache[e][s],n=o.length;for(let e=0;e<n;e++)o[e].apply(i,t||[])}}}}subscribe(e,t,i){return this._cache[e]||(this._cache[e]={}),"string"==typeof i?(this._cache[e][i]||(this._cache[e][i]=[]),this._cache[e][i].push(t)):(this._cache[e].global||(this._cache[e].global=[]),this._cache[e].global.push(t)),i?[e,t,i]:[e,t]}unsubscribe(e,t){let i=e[0];if(this._cache[i]){let s;let o=3===e.length?e[2]:"global";if(!(s=this._cache[i][o]))return!1;if(t)return delete this._cache[i][o],s.length>0;let n=s.length;for(;n--;)if(s[n]===e[1])return this._cache[i][o].splice(n,1),!0}return!1}unsubscribeAll(e){if(e){let t;let i=Object.keys(this._cache),s=i.length;for(;s--;)t=i[s],void 0!==this._cache[t][e]&&delete this._cache[t][e]}else this._cache={}}constructor(){e(this,"_cache",void 0),this._cache={}}}},l={onDoubleClick:function(e,t){e.addEventListener("dblclick",function(e){e.ctrlKey||t(e,d(e.currentTarget,e))});let i=c(500);e.addEventListener("contextmenu",function(e){e.preventDefault(),e.ctrlKey&&(i.isTriggered()?(i.reset(),t(e,d(e.currentTarget,e))):i.trigger())})},onPinch:function(e,t){let i=0;e.addEventListener("touchstart",function(e){e.preventDefault(),2===e.touches.length&&(i=h(e.touches[0].clientX,e.touches[0].clientY,e.touches[1].clientX,e.touches[1].clientY))}),e.addEventListener("touchmove",function(e){if(e.preventDefault(),2===e.touches.length){let s=e.touches,o=h(s[0].clientX,s[0].clientY,s[1].clientX,s[1].clientY);if(Math.abs(o-i)>0){let n={pageX:(s[0].clientX+s[1].clientX)/2,pageY:(s[0].clientY+s[1].clientY)/2};t(e,d(e.currentTarget,n),i,o)}}})},onDoubleTap:function(e,t){let i=c(250),s=null;e.addEventListener("touchend",e=>{if(e.preventDefault(),i.isTriggered()){i.reset();let o={pageX:e.changedTouches[0].clientX,pageY:e.changedTouches[0].clientY};50>h(s.pageX,s.pageY,o.pageX,o.pageY)&&t(e,d(e.currentTarget,o)),s=null}else s={pageX:e.changedTouches[0].clientX,pageY:e.changedTouches[0].clientY},i.trigger()})}};function h(e,t,i,s){return Math.sqrt((i-e)*(i-e)+(s-t)*(s-t))}function c(e){let t=!1,i=null;return{trigger(){t=!0,s(),i=setTimeout(function(){t=!1,i=null},e)},isTriggered:()=>t,reset(){t=!1,s()}};function s(){null!==i&&(clearTimeout(i),i=null)}}function d(e,t){let i=e.getBoundingClientRect();return{left:t.pageX-i.left,top:t.pageY-i.top}}function g(e,t){let i,s;if(null==e)return i;for(let o of e){let e=t(o);null!=e&&(void 0===s?e==e&&!function(e){let t=typeof e;return"symbol"===t||"object"===t&&null!=e&&"[object Symbol]"===(null==e?void 0===e?"[object Undefined]":"[object Null]":toString.call(e))}(e):e>s)&&(s=e,i=o)}return i}class u{mount(){null===this._pageToolsElem&&(this._buttons=this._initializePageToolButtons(),this._pageToolsElem=t("div",{class:"diva-page-tools-wrapper"},t("div",{class:"diva-page-tools"},this._buttons)),this._pageLabelsElem=t("div",{class:"diva-page-labels-wrapper"},t("div",{class:"diva-page-labels"},this._viewerCore.settings.manifest.pages[this.page].l))),this.refresh(),this._innerElement.appendChild(this._pageToolsElem),this._innerElement.appendChild(this._pageLabelsElem)}_initializePageToolButtons(){let e=this._viewerCore.getSettings(),t=this._viewerCore.getPublicInstance(),i=this.page;return this._viewerCore.getPageTools().map(s=>{let o=s.pageToolsIcon.cloneNode(!0);return o.addEventListener("click",o=>{s.handleClick.call(s,o,e,t,i)},!1),o.addEventListener("touchend",o=>{o.preventDefault(),s.handleClick.call(s,o,e,t,i)},!1),o})}unmount(){this._innerElement.removeChild(this._pageToolsElem),this._innerElement.removeChild(this._pageLabelsElem)}refresh(){let e=this._viewerCore.getPageRegion(this.page,{includePadding:!0,incorporateViewport:!0}),t=window.getComputedStyle(this._innerElement,null).getPropertyValue("margin-left");this._pageToolsElem.style.top=`${e.top}px`,this._pageToolsElem.style.left=`${e.left-parseInt(t)}px`,this._pageLabelsElem.style.top=`${e.top}px`,this._pageLabelsElem.style.left=`${e.right-parseInt(t)-this.labelWidth-5}px`}constructor(t,i){e(this,"page",void 0),e(this,"_viewerCore",void 0),e(this,"_innerElement",void 0),e(this,"_pageToolsElem",void 0),e(this,"_pageLabelsElem",void 0),e(this,"labelWidth",void 0),e(this,"_buttons",void 0),this.page=t,this._viewerCore=i,this._innerElement=this._viewerCore.getSettings().innerElement,this._pageToolsElem=null,this.labelWidth=0}}class v{onDoubleClick(e,t){let i=this._viewerCore.getSettings(),s=e.ctrlKey?i.zoomLevel-1:i.zoomLevel+1,o=this._viewerCore.getPagePositionAtViewportOffset(t);this._viewerCore.zoom(s,o)}onPinch(e,t,i,s){let o=this._viewerCore.getInternalState(),n=this._viewerCore.getSettings(),r=Math.log(Math.pow(2,n.zoomLevel)*s/(i*Math.log(2)))/Math.log(2);if(r=Math.max(n.minZoomLevel,r),(r=Math.min(n.maxZoomLevel,r))===n.zoomLevel)return;let a=this._viewerCore.getPagePositionAtViewportOffset(t),l=this._viewerCore.getCurrentLayout().getPageToViewportCenterOffset(a.anchorPage,o.viewport),h=1/Math.pow(2,n.zoomLevel-r);this._viewerCore.reload({zoomLevel:r,goDirectlyTo:a.anchorPage,horizontalOffset:l.x-a.offset.left+a.offset.left*h,verticalOffset:l.y-a.offset.top+a.offset.top*h})}onViewWillLoad(){this._viewerCore.publish("DocumentWillLoad",this._viewerCore.getSettings())}onViewDidLoad(){this._handleZoomLevelChange();let e=this._viewerCore.getSettings().activePageIndex,t=this._viewerCore.getPageName(e);this._viewerCore.publish("DocumentDidLoad",e,t)}onViewDidUpdate(e,t){let i=null!==t?t:function(e,t,i){let s=i.top+i.height/2,o=i.left+i.width/2,n=g(e,e=>{let i=t.getPageDimensions(e),n=t.getPageOffset(e,{includePadding:!0}),r=n.left+i.width/2,a=n.top+i.height/2,l=Math.max(Math.abs(o-r)-i.width/2,0),h=Math.max(Math.abs(s-a)-i.height/2,0);return-(l*l+h*h)});return null!=n?n:null}(e,this._viewerCore.getCurrentLayout(),this._viewerCore.getViewport()),s=this._viewerState.viewport.intersectionTolerance;this._viewerState.viewport.intersectionTolerance=0;let o=e.filter(e=>this._viewerState.renderer.isPageVisible(e));this._viewerState.viewport.intersectionTolerance=s,null!==i&&this._viewerCore.setCurrentPages(i,o),null!==t&&this._viewerCore.publish("ViewerDidJump",t),this._handleZoomLevelChange()}_handleZoomLevelChange(){let e=this._viewerState,t=e.options.zoomLevel;e.oldZoomLevel!==t&&e.oldZoomLevel>=0&&(e.oldZoomLevel<t?this._viewerCore.publish("ViewerDidZoomIn",t):this._viewerCore.publish("ViewerDidZoomOut",t),this._viewerCore.publish("ViewerDidZoom",t)),e.oldZoomLevel=t}destroy(){this._overlays.forEach(e=>{this._viewerCore.removePageOverlay(e)},this)}constructor(t){if(e(this,"_viewerCore",void 0),e(this,"_viewerState",void 0),e(this,"_overlays",void 0),this._viewerCore=t,this._viewerState=t.getInternalState(),this._overlays=[],this._viewerCore.getPageTools().length){let e=t.getSettings().numPages;for(let i=0;i<e;i++){let e=new u(i,t);this._overlays.push(e),this._viewerCore.addPageOverlay(e);let s=document.createElement("span");s.innerHTML=t.settings.manifest.pages[i].l,s.classList.add("diva-page-labels"),s.setAttribute("style","display: inline-block;"),document.body.appendChild(s);let o=s.clientWidth;document.body.removeChild(s),e.labelWidth=o}}}}class p{onDoubleClick(e,t){let i=this._viewerCore.getPagePositionAtViewportOffset(t),s=this._viewerCore.getCurrentLayout(),o=this._viewerCore.getViewport(),n=s.getPageToViewportCenterOffset(i.anchorPage,o);this._viewerCore.reload({inGrid:!1,goDirectlyTo:i.anchorPage,horizontalOffset:n.x+i.offset.left,verticalOffset:n.y+i.offset.top})}onPinch(){this._viewerCore.reload({inGrid:!1})}onViewWillLoad(){}onViewDidLoad(){}onViewDidUpdate(e,t){let i;if(0===e.length)return;let s=this._viewerCore.viewerState.viewport.intersectionTolerance;this._viewerCore.viewerState.viewport.intersectionTolerance=0;let o=e.filter(e=>this._viewerCore.viewerState.renderer.isPageVisible(e));if(this._viewerCore.viewerState.viewport.intersectionTolerance=s,null!==t){this._viewerCore.setCurrentPages(t,o);return}let n=this._viewerCore.getCurrentLayout(),r=[];e.forEach(e=>{let t=n.getPageInfo(e).group;(0===r.length||t!==r[r.length-1])&&r.push(t)});let a=this._viewerCore.getViewport();i=1===r.length||r[0].region.top>=a.top?r[0]:r[1].region.bottom<=a.bottom?r[1]:function(e,t){let i=t.top+t.height/2;return g(e,e=>-Math.abs(i-(e.region.top+e.dimensions.height/2)))}(r,a);let l=this._viewerCore.getSettings().activePageIndex;i.pages.some(e=>e.index===l)||this._viewerCore.setCurrentPages(i.pages[0].index,o)}destroy(){}constructor(t){e(this,"_viewerCore",void 0),this._viewerCore=t}}class m{addOverlay(e){(this._pages[e.page]||(this._pages[e.page]=[])).push(e),this._renderedPageMap[e.page]&&e.mount()}removeOverlay(e){let t=e.page,i=this._pages[t];if(!i)return;let s=i.indexOf(e);-1!==s&&(this._renderedPageMap[t]&&i[s].unmount(),i.splice(s,1),0===i.length&&delete this._pages[t])}updateOverlays(e){let t=this._renderedPages,i={};e.map(e=>{i[e]=!0,this._renderedPageMap[e]||(this._renderedPageMap[e]=!0,this._invokeOnOverlays(e,e=>{e.mount()}))}),t.map(e=>{i[e]?this._invokeOnOverlays(e,e=>{e.refresh()}):(delete this._renderedPageMap[e],this._invokeOnOverlays(e,e=>{e.unmount()}))}),this._renderedPages=e}_invokeOnOverlays(e,t){let i=this._pages[e];i&&i.map(e=>t(e))}constructor(){e(this,"_pages",void 0),e(this,"_renderedPages",void 0),e(this,"_renderedPageMap",void 0),this._pages={},this._renderedPages=[],this._renderedPageMap={}}}class f{isLoaded(e,t){return e>=this._rows||t>=this._cols||this._map[e][t]}set(e,t,i){this._map[e][t]=i}constructor(t,i){e(this,"_rows",void 0),e(this,"_cols",void 0),e(this,"_map",void 0),this._rows=t,this._cols=i,this._map=Array(t).fill(null).map(()=>Array(i).fill(!1))}}class w{clear(){let e=this._loadedByLevel={};this._levels.forEach(t=>{e[t.zoomLevel]=new f(t.rows,t.cols)})}getTiles(e){let t;let i=[],s=this._levels[0].zoomLevel,o=new f(this._levels[0].rows,this._levels[0].cols);if(null===e)t=0;else{let i=Math.ceil(e);t=function(e,t){let i=e.length;for(let s=0;s<i;s++)if(t(e[s],s))return s;return -1}(this._levels,e=>e.zoomLevel<=i)}this._levels.slice(0,t+1).reverse().concat(this._levels.slice(t+1)).forEach(e=>{let t=this._loadedByLevel[e.zoomLevel],n=e.tiles.filter(e=>t.isLoaded(e.row,e.col)),r=Math.pow(2,s-e.zoomLevel);n=n.filter(e=>{let t=!1,i=e.row*r,s=e.col*r;for(let e=0;e<r;e++)for(let n=0;n<r;n++)o.isLoaded(i+e,s+n)||(t=!0,o.set(i+e,s+n,!0));return t}),i.push(n)}),i.reverse();let n=[];return i.forEach(e=>{n.push.apply(n,e)}),n}updateFromCache(e){this.clear(),this._levels.forEach(t=>{let i=this._loadedByLevel[t.zoomLevel];t.tiles.forEach(t=>{e.has(t.url)&&i.set(t.row,t.col,!0)})},this)}updateWithLoadedUrls(e){e.forEach(e=>{let t=this._urlsToTiles[e];this._loadedByLevel[t.zoomLevel].set(t.row,t.col,!0)})}constructor(t){e(this,"_levels",void 0),e(this,"_urlsToTiles",void 0),e(this,"_loadedByLevel",void 0),this._levels=t;let i=this._urlsToTiles={};t.forEach(e=>{e.tiles.forEach(t=>{i[t.url]={zoomLevel:e.zoomLevel,row:t.row,col:t.col}})}),this.clear()}}class _{getPageInfo(e){return this._pageLookup[e]||null}getIndexOfFirstPage(){return Object.keys(this._pageLookup)[0]}getPageDimensions(e){if(!this._pageLookup||!this._pageLookup[e])return null;let t=b(this._pageLookup[e]);return{height:t.bottom-t.top,width:t.right-t.left}}getPageOffset(e,t){let i=this.getPageRegion(e,t);return i?{top:i.top,left:i.left}:null}getPageRegion(e,t){let i=this._pageLookup[e]||null;if(!i)return null;let s=b(i),o=i.group.padding;return t&&t.includePadding?{top:s.top+o.top,left:s.left+o.left,bottom:s.bottom,right:s.right}:{top:s.top,left:s.left,bottom:s.bottom+o.top,right:s.right}}getPageToViewportCenterOffset(e,t){let i=t.left,s=t.right-t.left,o=this.getPageOffset(e);if(!o)return null;let n=i-o.left+Math.floor(s/2),r=t.top,a=t.bottom-t.top;return{x:n,y:r-o.top+Math.floor(a/2)}}constructor(t,i){e(this,"dimensions",void 0),e(this,"pageGroups",void 0),e(this,"_pageLookup",void 0);let s=function(e,t){let i,s;let o=null===t?e.pageLayouts:function(e,t){let i=Math.pow(2,t-e.maxZoomLevel);return e.pageLayouts.map(e=>({dimensions:y(e.dimensions,i),pages:e.pages.map(e=>({index:e.index,groupOffset:{top:Math.floor(e.groupOffset.top*i),left:Math.floor(e.groupOffset.left*i)},dimensions:y(e.dimensions,i)}))}))}(e,t),n=function(e,t){let i,s;let o=e.padding.document;return e.verticallyOriented?(i="width",s=o.left+o.right):(i="height",s=o.top+o.bottom),s+t.reduce((e,t)=>Math.max(t.dimensions[i],e),0)}(e,o),r=e.verticallyOriented?e.padding.document.top:e.padding.document.left,a=[],l={top:e.padding.page.top,left:e.padding.page.left};return o.forEach((t,i)=>{let s,o;e.verticallyOriented?(s=r,o=(n-t.dimensions.width)/2):(s=(n-t.dimensions.height)/2,o=r);let h={top:s,bottom:s+l.top+t.dimensions.height,left:o,right:o+l.left+t.dimensions.width};a.push({index:i,dimensions:t.dimensions,pages:t.pages,region:h,padding:l}),r=e.verticallyOriented?h.bottom:h.right}),e.verticallyOriented?(i=r+l.top,s=n):(i=n,s=r+l.left),{dimensions:{height:i,width:s},pageGroups:a}}(t,i);this.dimensions=s.dimensions,this.pageGroups=s.pageGroups,this._pageLookup=function(e){let t={};return e.forEach(e=>{e.pages.forEach(i=>{t[i.index]={index:i.index,group:e,dimensions:i.dimensions,groupOffset:i.groupOffset}})}),t}(s.pageGroups)}}function b(e){let t=e.groupOffset.top+e.group.region.top,i=t+e.dimensions.height,s=e.groupOffset.left+e.group.region.left,o=s+e.dimensions.width;return{top:t,bottom:i,left:s,right:o}}function y(e,t){return{height:Math.floor(e.height*t),width:Math.floor(e.width*t)}}let P=i(227)("diva:ImageCache");class S{get(e){let t=this._urls[e];return t?t.img:null}has(e){return!!this._urls[e]}put(e,t){let i=this._urls[e];i?(i.img=t,this._promote(i)):(i={img:t,url:e},this._urls[e]=i,this._tryEvict(1),this._lru.unshift(i))}_promote(e){let t=this._lru.indexOf(e);this._lru.splice(t,1),this._lru.unshift(e)}_tryEvict(e){let t=this.maxKeys-e;if(this._lru.length<=t)return;let i=this._lru.length-1;for(;;){let e=this._lru[i];if(!this._held[e.url]&&(P("Evicting image %s",e.url),this._lru.splice(i,1),delete this._urls[e.url],this._lru.length<=t))break;if(0===i){P.enabled&&P("Cache overfull by %s (all entries are being held)",this._lru.length-t);break}i--}}acquire(e){this._held[e]=(this._held[e]||0)+1,this._promote(this._urls[e])}release(e){this._held[e]>1?this._held[e]--:delete this._held[e],this._tryEvict(0)}constructor(t){e(this,"maxKeys",void 0),e(this,"_held",void 0),e(this,"_urls",void 0),e(this,"_lru",void 0),t=t||{maxKeys:100},this.maxKeys=t.maxKeys||100,this._held={},this._urls={},this._lru=[]}}class C{abort(){clearTimeout(this.timeout),this._image&&(this._image.onload=this._image.onerror=null,this._image.src=""),this._aborted=!0}_handleLoad(){if(this._aborted){console.error("ImageRequestHandler invoked on cancelled request for "+this._url);return}if(this._complete){console.error("ImageRequestHandler invoked on completed request for "+this._url);return}this._complete=!0,this._callback(this._image)}_handleError(){this._errorCallback(this._image)}constructor(t){e(this,"_image",void 0),e(this,"_callback",void 0),e(this,"_errorCallback",void 0),e(this,"timeout",void 0),e(this,"timeoutTime",void 0),e(this,"_aborted",void 0),e(this,"_crossOrigin",void 0),e(this,"_url",void 0),e(this,"_complete",void 0),this._url=t.url,this._callback=t.load,this._errorCallback=t.error,this.timeoutTime=t.timeoutTime||0,this._aborted=this._complete=!1,this._crossOrigin=t.settings.imageCrossOrigin,this.timeout=setTimeout(()=>{this._image=new Image,this._image.crossOrigin=this._crossOrigin,this._image.onload=this._handleLoad.bind(this),this._image.onerror=this._handleError.bind(this),this._image.src=t.url},this.timeoutTime)}}let L={animate:function(e){let t=e.duration,i=e.parameters,s=e.onUpdate,o=e.onEnd,n=x(),r=n+t,a={},l={},h=Object.keys(i);h.forEach(e=>{var t,s,o;let n=i[e];a[e]=(t=n.from,s=n.to,o=n.easing||O,e=>t+(s-t)*o(e))});let c=requestAnimationFrame(function e(){var i;let o=x();i=Math.min((o-n)/t,1),h.forEach(e=>{l[e]=a[e](i)}),s(l),o<r?c=requestAnimationFrame(e):d({interrupted:!1})});return{cancel(){null!==c&&(cancelAnimationFrame(c),d({interrupted:!0}))}};function d(e){c=null,o&&o(e)}}},x=()=>performance.now();function O(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}class E{static getCompatibilityErrors(){return"undefined"!=typeof HTMLCanvasElement?null:["Your browser lacks support for the canvas element. Please upgrade your browser."]}load(e,t,i){this._clearAnimation(),this._hooks.onViewWillLoad&&this._hooks.onViewWillLoad(),this._sourceResolver=i,this._config=e,this._compositeImages=[],this._setLayoutToZoomLevel(t.zoomLevel),this.layout&&!this.layout.getPageInfo(t.anchorPage)&&(t.anchorPage=parseInt(this.layout.getIndexOfFirstPage(),10)),(this._canvas.width!==this._viewport.width||this._canvas.height!==this._viewport.height)&&(this._canvas.width=this._viewport.width,this._canvas.height=this._viewport.height),this.goto(t.anchorPage,t.verticalOffset,t.horizontalOffset),this._canvas.parentNode!==this._outerElement&&this._outerElement.insertBefore(this._canvas,this._outerElement.firstChild),this._hooks.onViewDidLoad&&this._hooks.onViewDidLoad()}_setViewportPosition(e){if(e.zoomLevel!==this._zoomLevel){if(null===this._zoomLevel)throw TypeError("The current view is not zoomable");if(null===e.zoomLevel)throw TypeError("The current view requires a zoom level");this._setLayoutToZoomLevel(e.zoomLevel)}this._goto(e.anchorPage,e.verticalOffset,e.horizontalOffset)}_setLayoutToZoomLevel(e){this.layout=new _(this._config,e),this._zoomLevel=e,s(this._documentElement,{style:{height:this.layout.dimensions.height+"px",width:this.layout.dimensions.width+"px"}}),this._viewport.setInnerDimensions(this.layout.dimensions)}adjust(){this._clearAnimation(),this._render(),this._hooks.onViewDidUpdate&&this._hooks.onViewDidUpdate(this._renderedPages.slice(),null)}_render(){let e=[];this.layout.pageGroups.forEach(t=>{if(!this._viewport.intersectsRegion(t.region))return;let i=t.pages.filter(e=>this.isPageVisible(e.index)).map(e=>e.index);e.push.apply(e,i)},this),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._paintOutline(e),e.forEach((e,t,i)=>{if(!this._compositeImages[t]){let e=this.layout.getPageInfo(t),i=new w(this._sourceResolver.getAllZoomLevelsForPage(e));i.updateFromCache(this._cache),this._compositeImages[t]=i}}),this._initiateTileRequests(e);let t=D(this._renderedPages||[],e);t.removed.forEach(e=>{delete this._compositeImages[e]}),this._renderedPages=e,this._paint(),this._hooks.onPageWillLoad&&t.added.forEach(e=>{this._hooks.onPageWillLoad(e)},this)}_paint(){let e=[];this._renderedPages.forEach((t,i,s)=>{this._compositeImages[i].getTiles(this._zoomLevel).forEach(t=>{let s=I(t,this._zoomLevel);this._isTileVisible(i,s)&&(e.push(t.url),this._drawTile(i,s,this._cache.get(t.url)))})});let t=this._cache,i=D(this._renderedTiles||[],e);i.added.forEach(e=>{t.acquire(e)}),i.removed.forEach(e=>{t.release(e)}),i.removed&&this._renderedPages.forEach((e,t,i)=>{this._compositeImages[t].updateFromCache(this._cache)},this),this._renderedTiles=e}_paintOutline(e){e.forEach((e,t,i)=>{let s=this.layout.getPageInfo(t),o=this._getImageOffset(t),n=Math.max(0,(this._viewport.width-this.layout.dimensions.width)/2),r=Math.max(0,(this._viewport.height-this.layout.dimensions.height)/2),a=o.left-this._viewport.left+n,l=o.top-this._viewport.top+r,h=Math.max(0,a),c=Math.max(0,l),d=s.dimensions.width-(a<0?-a:0),g=s.dimensions.height-(l<0?-l:0);this._ctx.strokeStyle="#AAA",this._ctx.strokeRect(h+.5,c+.5,d,g)})}_initiateTileRequests(e){let t={},i=(e,i)=>{let s=this._compositeImages[i];t[e.url]=new C({url:e.url,timeoutTime:250,settings:this._settings,load:t=>{delete this._pendingRequests[e.url],this._cache.put(e.url,t),s===this._compositeImages[i]&&s.updateWithLoadedUrls([e.url]),this._isTileForSourceVisible(i,e)&&this._paint()},error:()=>{delete this._pendingRequests[e.url]}})};for(let s=0;s<e.length;s++){let o=e[s],n=this._sourceResolver.getBestZoomLevelForPage(this.layout.getPageInfo(o)).tiles;for(let e=0;e<n.length;e++){let s=n[e];if(!this._cache.has(s.url)&&this._isTileForSourceVisible(o,s)){if(this._pendingRequests[s.url]){t[s.url]=this._pendingRequests[s.url],delete this._pendingRequests[s.url];continue}i(s,o)}}}for(let e in this._pendingRequests)this._pendingRequests[e].abort();this._pendingRequests=t}_drawTile(e,t,i){let s=this._getTileToDocumentOffset(e,t),o=Math.max(0,(this._viewport.width-this.layout.dimensions.width)/2),n=Math.max(0,(this._viewport.height-this.layout.dimensions.height)/2),r=s.left-this._viewport.left+o,a=s.top-this._viewport.top+n,l=r<0?-r:0,h=a<0?-a:0,c=Math.max(0,r),d=Math.max(0,a),g=l/t.scaleRatio,u=h/t.scaleRatio,v=Math.min(t.dimensions.width,i.width*t.scaleRatio)-l,p=Math.min(t.dimensions.height,i.height*t.scaleRatio)-h,m=Math.max(1,Math.round(v)),f=Math.max(1,Math.round(p)),w=m/t.scaleRatio,_=f/t.scaleRatio;this._ctx.drawImage(i,g,u,w,_,c,d,m,f)}_isTileForSourceVisible(e,t){return this._isTileVisible(e,I(t,this._zoomLevel))}_isTileVisible(e,t){let i=this._getTileToDocumentOffset(e,t);return this._viewport.intersectsRegion({top:i.top,bottom:i.top+t.dimensions.height,left:i.left,right:i.left+t.dimensions.width})}_getTileToDocumentOffset(e,t){let i=this._getImageOffset(e);return{top:i.top+t.offset.top,left:i.left+t.offset.left}}_getImageOffset(e){return this.layout.getPageOffset(e,{includePadding:!0})}goto(e,t,i){this._clearAnimation(),this._goto(e,t,i),this._hooks.onViewDidUpdate&&this._hooks.onViewDidUpdate(this._renderedPages.slice(),e)}_goto(e,t,i){let s=this.layout.getPageOffset(e),o=s.top+t-Math.round(this._viewport.height/2),n=s.left+i-Math.round(this._viewport.width/2);this._viewport.top=o,this._viewport.left=n,this._render()}transitionViewportPosition(e){this._clearAnimation();let t=e.getPosition,i=this._hooks.onViewDidTransition;this._animation=L.animate({duration:e.duration,parameters:e.parameters,onUpdate:e=>{this._setViewportPosition(t(e)),this._hooks.onZoomLevelWillChange(e.zoomLevel),i&&i()},onEnd:t=>{e.onEnd&&e.onEnd(t),this._hooks.onViewDidUpdate&&!t.interrupted&&this._hooks.onViewDidUpdate(this._renderedPages.slice(),null)}})}_clearAnimation(){this._animation&&(this._animation.cancel(),this._animation=null)}isPageVisible(e){return!!(this.layout&&this.layout.getPageInfo(e))&&this._viewport.intersectsRegion(this.layout.getPageRegion(e))}getRenderedPages(){return this._renderedPages.slice()}destroy(){this._clearAnimation(),Object.keys(this._pendingRequests).forEach(e=>{let t=this._pendingRequests[e];delete this._pendingRequests[e],t.abort()},this),this._canvas.parentNode.removeChild(this._canvas)}constructor(i,s){e(this,"_viewport",void 0),e(this,"_outerElement",void 0),e(this,"_documentElement",void 0),e(this,"_settings",void 0),e(this,"_hooks",void 0),e(this,"_canvas",void 0),e(this,"_ctx",void 0),e(this,"_sourceResolver",void 0),e(this,"_renderedPages",void 0),e(this,"_config",void 0),e(this,"_zoomLevel",void 0),e(this,"_compositeImages",void 0),e(this,"_renderedTiles",void 0),e(this,"_animation",void 0),e(this,"_cache",void 0),e(this,"_pendingRequests",void 0),e(this,"layout",void 0),this._viewport=i.viewport,this._outerElement=i.outerElement,this._documentElement=i.innerElement,this._settings=i.settings,this._hooks=s||{},this._canvas=t("canvas",{class:"diva-viewer-canvas"}),this._ctx=this._canvas.getContext("2d"),this._ctx.imageSmoothingEnabled=!0,this.layout=null,this._sourceResolver=null,this._renderedPages=null,this._config=null,this._zoomLevel=null,this._compositeImages=[],this._renderedTiles=null,this._animation=null,this._cache=new S,this._pendingRequests={}}}function I(e,t){let i;return i=null===t?1:Math.pow(2,t-e.zoomLevel),{sourceZoomLevel:e.zoomLevel,scaleRatio:i,row:e.row,col:e.col,dimensions:{width:e.dimensions.width*i,height:e.dimensions.height*i},offset:{left:e.offset.left*i,top:e.offset.top*i},url:e.url}}function D(e,t){if(e===t)return{added:[],removed:[]};let i=e.filter(e=>-1===t.indexOf(e));return{added:t.filter(t=>-1===e.indexOf(t)),removed:i}}function T(e,t){let i=t.getMaxPageDimensions(e);return{width:Math.floor(i.width),height:Math.floor(i.height)}}function M(e,t){let i={};return t.forEach(function(t){i[t]=e[t]}),i}class z{isValid(e,t,i){let s=null;if(this.validations.some((t,i)=>t.key===e&&(s=i,!0)),null===s)return!0;let o={};o[e]=t;let n=V(i,o,this);return!this._runValidation(s,t,n)}validate(e){this._validateOptions({},e)}getValidatedOptions(e,t){let i=Object.assign({},t);return this._validateOptions(e,i),i}_validateOptions(e,t){let i=V(e,t,this);this._applyValidations(t,i)}_applyValidations(e,t){this.validations.forEach((i,s)=>{var o;if(!e.hasOwnProperty(i.key))return;let n=e[i.key],r=this._runValidation(s,n,t);r&&(r.warningSuppressed||(o=i.key,console.warn("Invalid value for "+o+": "+n+". Using "+r.value+" instead.")),e[i.key]=r.value)},this)}_runValidation(e,t,i){let s=this.validations[e];i.index=e;let o=!1,n=s.validate(t,i.proxy,{suppressWarning:()=>{o=!0}});return void 0===n||n===t?null:{value:n,warningSuppressed:o}}constructor(t){e(this,"whitelistedKeys",void 0),e(this,"additionalProperties",void 0),e(this,"validations",void 0),this.whitelistedKeys=t.whitelistedKeys||[],this.additionalProperties=t.additionalProperties||[],this.validations=t.validations}}function V(e,t,i){let s={proxy:{},index:null},o=F.bind(null,e,t),n={};return i.whitelistedKeys.forEach(e=>{n[e]={get:o.bind(null,e)}}),i.additionalProperties.forEach(e=>{n[e.key]={get:e.get}}),i.validations.forEach((e,t)=>{n[e.key]={get:()=>{if(t<s.index)return o(e.key);let n=i.validations[s.index].key;throw TypeError("Cannot access setting "+e.key+" while validating "+n)}}}),Object.defineProperties(s.proxy,n),s}function F(e,t,i){return i in t?t[i]:e[i]}class k{intersectsRegion(e){return this.hasHorizontalOverlap(e)&&this.hasVerticalOverlap(e)}hasVerticalOverlap(e){var t,i,s,o,n,r;let a=this.top-this.intersectionTolerance,l=this.bottom+this.intersectionTolerance;return t=e.top,i=a,s=l,t>=i&&t<=s||(o=e.bottom,n=a,r=l,o>=n&&o<=r)||e.top<=a&&e.bottom>=l}hasHorizontalOverlap(e){var t,i,s,o,n,r;let a=this.left-this.intersectionTolerance,l=this.right+this.intersectionTolerance;return t=e.left,i=a,s=l,t>=i&&t<=s||(o=e.right,n=a,r=l,o>=n&&o<=r)||e.left<=a&&e.right>=l}invalidate(){this._width=this.outer.clientWidth,this._height=this.outer.clientHeight,this._top=this.outer.scrollTop,this._left=this.outer.scrollLeft}setInnerDimensions(e){var t,i,s,o;this._innerDimensions=e,e&&(this._top=(t=this._top,i=0,j(H(t,e.height-this._height),0)),this._left=(s=this._left,o=0,j(H(s,e.width-this._width),0)))}constructor(t,i){e(this,"intersectionTolerance",void 0),e(this,"outer",void 0),e(this,"_top",void 0),e(this,"_left",void 0),e(this,"_width",void 0),e(this,"_height",void 0),e(this,"_innerDimensions",void 0),e(this,"top",void 0),e(this,"bottom",void 0),e(this,"left",void 0),e(this,"right",void 0),i=i||{},this.intersectionTolerance=i.intersectionTolerance||0,this.outer=t,this._top=this._left=this._width=this._height=this._innerDimensions=null,this.invalidate()}}function A(e,t){let i="_"+e,s="scroll"+e.charAt(0).toUpperCase()+e.slice(1);return{get:function(){return this[i]},set:function(e){var o;let n;n=this._innerDimensions?(o=0,j(H(e,this._innerDimensions[t]-this[t]),0)):j(e,0),this[i]=this.outer[s]=n}}}function R(e){return{get:function(){return this["_"+e]}}}function j(e,t){return Math.max(e,t)}function H(e,t){return Math.min(e,t)}Object.defineProperties(k.prototype,{top:A("top","height"),left:A("left","width"),width:R("width"),height:R("height"),bottom:{get:function(){return this._top+this._height}},right:{get:function(){return this._left+this._width}}});let Z=i(227)("diva:ViewerCore");function B(){return B.counter++}B.counter=1;let G=[{key:"goDirectlyTo",validate:(e,t)=>e<0||e>=t.manifest.pages.length?0:e},{key:"minPagesPerRow",validate:e=>Math.max(2,e)},{key:"maxPagesPerRow",validate:(e,t)=>Math.max(e,t.minPagesPerRow)},{key:"pagesPerRow",validate:(e,t)=>e<t.minPagesPerRow||e>t.maxPagesPerRow?t.maxPagesPerRow:e},{key:"maxZoomLevel",validate:(e,t,i)=>(i.suppressWarning(),e<0||e>t.manifest.maxZoom)?t.manifest.maxZoom:e},{key:"minZoomLevel",validate:(e,t,i)=>e>t.manifest.maxZoom?(i.suppressWarning(),0):e<0||e>t.maxZoomLevel?0:e},{key:"zoomLevel",validate:(e,t,i)=>e>t.manifest.maxZoom?(i.suppressWarning(),0):e<t.minZoomLevel||e>t.maxZoomLevel?t.minZoomLevel:e}];class N{isValidOption(e,t){return this.optionsValidator.isValid(e,t,this.viewerState.options)}elemAttrs(e,t){let i={id:this.settings.ID+e,class:"diva-"+e};return t?Object.assign(i,t):i}getPageData(e,t){return this.settings.manifest.pages[e].d[this.settings.zoomLevel][t]}clearViewer(){this.viewerState.viewport.top=0,clearTimeout(this.viewerState.resizeTimer)}hasChangedOption(e,t){return t in e&&e[t]!==this.settings[t]}escapeListener(e){"Escape"===e.code&&this.publicInstance.leaveFullscreenMode()}reloadViewer(e){let t=[];if(e=this.optionsValidator.getValidatedOptions(this.settings,e),this.hasChangedOption(e,"zoomLevel")&&(this.viewerState.oldZoomLevel=this.settings.zoomLevel,this.viewerState.options.zoomLevel=e.zoomLevel,t.push(["ZoomLevelDidChange",e.zoomLevel])),this.hasChangedOption(e,"pagesPerRow")&&(this.viewerState.options.pagesPerRow=e.pagesPerRow,t.push(["GridRowNumberDidChange",e.pagesPerRow])),this.hasChangedOption(e,"verticallyOriented")&&(this.viewerState.options.verticallyOriented=e.verticallyOriented),this.hasChangedOption(e,"showNonPagedPages")&&(this.viewerState.options.showNonPagedPages=e.showNonPagedPages),"goDirectlyTo"in e?(this.viewerState.options.goDirectlyTo=e.goDirectlyTo,"verticalOffset"in e&&(this.viewerState.verticalOffset=e.verticalOffset),"horizontalOffset"in e&&(this.viewerState.horizontalOffset=e.horizontalOffset)):this.viewerState.options.goDirectlyTo=this.settings.activePageIndex,(this.hasChangedOption(e,"inGrid")||this.hasChangedOption(e,"inBookLayout"))&&("inGrid"in e&&(this.viewerState.options.inGrid=e.inGrid),"inBookLayout"in e&&(this.viewerState.options.inBookLayout=e.inBookLayout),t.push(["ViewDidSwitch",this.settings.inGrid])),this.hasChangedOption(e,"inFullscreen")&&(this.viewerState.options.inFullscreen=e.inFullscreen,this.prepareModeChange(e),t.push(["ModeDidSwitch",this.settings.inFullscreen])),this.clearViewer(),this.updateViewHandlerAndRendering(),this.viewerState.renderer){let e={pageLayouts:function(e){if(e.inGrid)return function(e){let t=e.viewport.width,i=e.manifest,s=e.pagesPerRow,o=e.fixedHeightGrid,n=e.fixedPadding,r=e.showNonPagedPages,a=(t-n*(s+1))/s,l=o?n+i.minRatio*a:n+i.maxRatio*a,h=[],c=[],d=e=>{let t,i;let s=e.d[e.d.length-1],r=s.h/s.w;return o?(t=(l-n)/r,i=l-n):i=(t=a)*r,{width:Math.round(t),height:Math.round(i)}},g={height:l,width:t};return i.pages.forEach((e,t)=>{if(!r&&i.paged&&!e.paged)return;let l=d(e),u=Math.floor(c.length*(n+a)+n);o&&(u+=(a-l.width)/2),c.push({index:t,dimensions:l,groupOffset:{top:0,left:u}}),c.length===s&&(h.push({dimensions:g,pages:c}),c=[])}),c.length>0&&h.push({dimensions:g,pages:c}),h}(M(e,["manifest","viewport","pagesPerRow","fixedHeightGrid","fixedPadding","showNonPagedPages"]));{let t=M(e,["manifest","verticallyOriented","showNonPagedPages"]);return e.inBookLayout?(function(e){let t=e.manifest,i=[],s=null,o=[],n=()=>{for(let e=0,t=o.length;e<t;e++)i.push([o[e]]);o=[]};return t.pages.forEach((r,a)=>{let l={index:a,dimensions:T(a,t),paged:!t.paged||r.paged};(e.showNonPagedPages||l.paged)&&(l.paged?0===a||r.facingPages?(i.push([l]),n()):null===s?s=l:(i.push([s,l]),s=null,n()):o.push(l))}),null!==s&&(i.push([s]),n()),i})(t).map(e=>(function(e,t){let i;let s=e.verticallyOriented;if(2===t.length)return function(e,t,i){let s,o,n;let r=e.dimensions,a=t.dimensions,l=Math.max(r.height,a.height);if(i){let e=Math.max(r.width,a.width);s=2*e,o=e-r.width,n=e}else s=r.width+a.width,o=0,n=r.width;return{dimensions:{height:l,width:s},pages:[{index:e.index,dimensions:r,groupOffset:{top:0,left:o}},{index:t.index,dimensions:a,groupOffset:{top:0,left:n}}]}}(t[0],t[1],s);let o=t[0],n=o.dimensions;i=o.paged?0===o.index&&s?n.width:0:s?n.width/2:0;let r=s&&!e.manifest.pages[o.index].facingPages;return{dimensions:{height:n.height,width:r?2*n.width:n.width},pages:[{index:o.index,groupOffset:{top:0,left:i},dimensions:n}]}})(t,e)):function(e){let t=e.manifest,i=[];return t.pages.forEach((s,o)=>{if(!e.showNonPagedPages&&t.paged&&!s.paged)return;let n=T(o,t);i.push({dimensions:n,pages:[{index:o,groupOffset:{top:0,left:0},dimensions:n}]})}),i}(t)}}(this.settings),padding:this.getPadding(),maxZoomLevel:this.settings.inGrid?null:this.viewerState.manifest.maxZoom,verticallyOriented:this.settings.verticallyOriented||this.settings.inGrid},t={zoomLevel:this.settings.inGrid?null:this.settings.zoomLevel,anchorPage:this.settings.goDirectlyTo,verticalOffset:this.viewerState.verticalOffset,horizontalOffset:this.viewerState.horizontalOffset},i=this.getCurrentSourceProvider();Z.enabled&&Z("reload with %s",Object.keys(e).filter(function(e){return"pageLayouts"!==e&&"padding"!==e}).map(function(t){let i=e[t];return t+": "+JSON.stringify(i)}).join(", ")),this.viewerState.renderer.load(e,t,i)}return t.forEach(e=>{this.publish.apply(this,e)}),!0}prepareModeChange(e){let t=e.inFullscreen?"add":"remove";this.viewerState.outerObject.classList[t]("diva-fullscreen"),document.body.classList[t]("diva-hide-scrollbar"),this.settings.parentObject.classList[t]("diva-full-width");let i=this.settings.panelHeight,s=this.settings.panelWidth;if(this.viewerState.viewport.invalidate(),!this.viewerState.loaded&&!this.settings.inGrid&&!("verticalOffset"in e)){let e=this.settings.panelHeight,t=this.settings.panelWidth;this.viewerState.verticalOffset+=(i-e)/2,this.viewerState.horizontalOffset+=(s-t)/2}e.inFullscreen?document.addEventListener("keyup",this.boundEscapeListener):document.removeEventListener("keyup",this.boundEscapeListener)}updateViewHandlerAndRendering(){let e=this.settings.inGrid?p:v;!this.viewerState.viewHandler||this.viewerState.viewHandler instanceof e||(this.viewerState.viewHandler.destroy(),this.viewerState.viewHandler=null),this.viewerState.viewHandler||(this.viewerState.viewHandler=new e(this)),this.viewerState.renderer||this.initializeRenderer()}initializeRenderer(){let e=E.getCompatibilityErrors();if(e)this.showError(e);else{let e={viewport:this.viewerState.viewport,outerElement:this.viewerState.outerElement,innerElement:this.viewerState.innerElement,settings:this.settings};this.viewerState.renderer=new E(e,{onViewWillLoad:()=>{this.viewerState.viewHandler.onViewWillLoad()},onViewDidLoad:()=>{this.updatePageOverlays(),this.viewerState.viewHandler.onViewDidLoad()},onViewDidUpdate:(e,t)=>{this.updatePageOverlays(),this.viewerState.viewHandler.onViewDidUpdate(e,t)},onViewDidTransition:()=>{this.updatePageOverlays()},onPageWillLoad:e=>{this.publish("PageWillLoad",e)},onZoomLevelWillChange:e=>{this.publish("ZoomLevelWillChange",e)}})}}getCurrentSourceProvider(){if(this.settings.inGrid){let e={getAllZoomLevelsForPage:t=>[e.getBestZoomLevelForPage(t)],getBestZoomLevelForPage:e=>({zoomLevel:1,rows:1,cols:1,tiles:[{url:this.settings.manifest.getPageImageURL(e.index,{width:e.dimensions.width}),zoomLevel:1,row:0,col:0,dimensions:e.dimensions,offset:{top:0,left:0}}]})};return e}let e={width:this.settings.tileWidth,height:this.settings.tileHeight};return{getBestZoomLevelForPage:t=>this.settings.manifest.getPageImageTiles(t.index,Math.ceil(this.settings.zoomLevel),e),getAllZoomLevelsForPage:t=>{let i=[],s=this.viewerState.manifest.maxZoom;for(let o=0;o<=s;o++)i.push(this.settings.manifest.getPageImageTiles(t.index,o,e));return i.reverse(),i}}}getPadding(){let e,t,i,s;return this.settings.inGrid?(i=this.settings.fixedPadding,e=t=s=0):(e=this.settings.verticallyOriented?this.viewerState.verticalPadding:0,t=this.settings.verticallyOriented?0:this.viewerState.horizontalPadding,i=this.settings.verticallyOriented?0:this.viewerState.verticalPadding,s=this.settings.verticallyOriented?this.viewerState.horizontalPadding:0),{document:{top:i,bottom:i,left:s,right:s},page:{top:e,bottom:0,left:t,right:0}}}updatePageOverlays(){this.viewerState.pageOverlays.updateOverlays(this.viewerState.renderer.getRenderedPages())}handleZoom(e,t){if(!this.isValidOption("zoomLevel",e))return!1;if(this.viewerState.viewportObject.removeEventListener("scroll",this.boundScrollFunction),!t){let e=this.viewerState.viewport,i=this.viewerState.renderer.layout.getPageRegion(this.settings.activePageIndex);t={anchorPage:this.settings.activePageIndex,offset:{left:e.width/2-(i.left-e.left),top:e.height/2-(i.top-e.top)}}}let i=this.viewerState.renderer.layout.getPageRegion(t.anchorPage),s=i.left+t.offset.left-(this.settings.viewport.left+this.settings.viewport.width/2),o=i.top+t.offset.top-(this.settings.viewport.top+this.settings.viewport.height/2),n=(e,i)=>{let n=Math.pow(2,e-i),r=t.offset.left*n-s,a=t.offset.top*n-o;return{zoomLevel:e,anchorPage:t.anchorPage,verticalOffset:a,horizontalOffset:r}};this.viewerState.options.zoomLevel=e;let r=this.viewerState.oldZoomLevel;this.viewerState.oldZoomLevel=this.settings.zoomLevel;let a=n(e,r);this.viewerState.options.goDirectlyTo=a.anchorPage,this.viewerState.verticalOffset=a.verticalOffset,this.viewerState.horizontalOffset=a.horizontalOffset,this.viewerState.renderer.transitionViewportPosition({duration:this.settings.zoomDuration,parameters:{zoomLevel:{from:r,to:e}},getPosition:e=>n(e.zoomLevel,r),onEnd:t=>{this.viewerState.viewportObject.addEventListener("scroll",this.boundScrollFunction),t.interrupted&&(this.viewerState.oldZoomLevel=e)}});let l=document.getElementById(this.settings.selector+"zoom-in-button"),h=document.getElementById(this.settings.selector+"zoom-out-button");return l.disabled=!0,h.disabled=!0,setTimeout(()=>{l.disabled=!1,h.disabled=!1},this.settings.zoomDuration),this.publish("ZoomLevelDidChange",e),!0}getYOffset(e,t){let i=void 0===e?this.settings.activePageIndex:e;return"center"===t||"centre"===t?Math.floor(this.getPageData(i,"h")/2):"bottom"===t?Math.floor(this.getPageData(i,"h")-this.settings.panelHeight/2):Math.floor(this.settings.panelHeight/2)}getXOffset(e,t){let i=void 0===e?this.settings.activePageIndex:e;return"left"===t?Math.floor(this.settings.panelWidth/2):"right"===t?Math.floor(this.getPageData(i,"w")-this.settings.panelWidth/2):Math.floor(this.getPageData(i,"w")/2)}updatePanelSize(){return this.viewerState.viewport.invalidate(),this.viewerState.renderer&&(this.updateOffsets(),this.viewerState.renderer.goto(this.settings.activePageIndex,this.viewerState.verticalOffset,this.viewerState.horizontalOffset)),!0}updateOffsets(){let e=this.viewerState.renderer.layout.getPageToViewportCenterOffset(this.settings.activePageIndex,this.viewerState.viewport);e&&(this.viewerState.horizontalOffset=e.x,this.viewerState.verticalOffset=e.y)}bindMouseEvents(){this.viewerState.viewportObject.classList.add("dragscroll"),l.onDoubleClick(this.viewerState.viewportObject,(e,t)=>{Z("Double click at %s, %s",t.left,t.top),this.viewerState.viewHandler.onDoubleClick(e,t)})}onResize(){this.updatePanelSize(),clearTimeout(this.viewerState.resizeTimer),this.viewerState.resizeTimer=setTimeout(()=>{let e=this.viewerState.renderer.layout.getPageToViewportCenterOffset(this.settings.activePageIndex,this.viewerState.viewport);e?this.reloadViewer({goDirectlyTo:this.settings.activePageIndex,verticalOffset:e.y,horizontalOffset:e.x}):this.reloadViewer({goDirectlyTo:this.settings.activePageIndex})},200)}bindTouchEvents(){this.settings.blockMobileMove&&document.body.addEventListener("touchmove",e=>(e.preventDefault(),!1)),l.onPinch(this.viewerState.viewportObject,(e,t,i,s)=>{Z("Pinch %s at %s, %s",s-i,t.left,t.top),this.viewerState.viewHandler.onPinch(e,t,i,s)}),l.onDoubleTap(this.viewerState.viewportObject,(e,t)=>{Z("Double tap at %s, %s",t.left,t.top),this.viewerState.viewHandler.onDoubleClick(e,t)})}scrollFunction(){let e;let t=this.viewerState.viewport.top,i=this.viewerState.viewport.left;this.viewerState.viewport.invalidate();let s=this.viewerState.viewport.top,o=this.viewerState.viewport.left;e=this.settings.verticallyOriented||this.settings.inGrid?s-t:o-i,this.viewerState.renderer.adjust();let n=this.settings.verticallyOriented||this.settings.inGrid?s:o;this.publish("ViewerDidScroll",n),e>0?this.publish("ViewerDidScrollDown",n):e<0&&this.publish("ViewerDidScrollUp",n),this.updateOffsets()}handleEvents(){this.viewerState.innerObject.addEventListener("mousedown",()=>{this.viewerState.innerObject.classList.add("diva-grabbing")}),this.viewerState.innerObject.addEventListener("mouseup",()=>{this.viewerState.innerObject.classList.remove("diva-grabbing")}),this.bindMouseEvents(),this.viewerState.viewportObject.addEventListener("scroll",this.boundScrollFunction),document.addEventListener("keydown.diva",e=>{if(!this.viewerState.isActiveDiva)return!0;if(this.settings.enableSpaceScroll&&!e.shiftKey&&32===e.keyCode||this.settings.enableKeyScroll&&34===e.keyCode)return this.viewerState.viewport.top+=this.settings.panelHeight,!1;if(this.settings.enableSpaceScroll||32!==e.keyCode||e.preventDefault(),this.settings.enableKeyScroll){if(e.shiftKey||e.ctrlKey||e.metaKey)return!0;switch(e.keyCode){case 33:return this.viewerState.viewport.top-=this.settings.panelHeight,!1;case 38:return this.viewerState.viewport.top-=this.settings.arrowScrollAmount,!1;case 40:return this.viewerState.viewport.top+=this.settings.arrowScrollAmount,!1;case 37:return this.viewerState.viewport.left-=this.settings.arrowScrollAmount,!1;case 39:return this.viewerState.viewport.left+=this.settings.arrowScrollAmount,!1;case 36:return this.viewerState.viewport.top=0,!1;case 35:return this.settings.verticallyOriented?this.viewerState.viewport.top=1/0:this.viewerState.viewport.left=1/0,!1}}return!0}),a.Events.subscribe("ViewerDidTerminate",()=>{document.removeEventListener("keydown.diva")},this.settings.ID),window.addEventListener("resize",this.onResize.bind(this),!1),a.Events.subscribe("ViewerDidTerminate",function(){window.removeEventListener("resize",this.onResize,!1)},this.settings.ID),"onorientationchange"in window&&(window.addEventListener("orientationchange",this.onResize,!1),a.Events.subscribe("ViewerDidTerminate",function(){window.removeEventListener("orientationchange",this.onResize,!1)},this.settings.ID)),a.Events.subscribe("PanelSizeDidChange",this.updatePanelSize,this.settings.ID),a.Events.subscribe("ViewerDidTerminate",()=>{this.viewerState.renderer&&this.viewerState.renderer.destroy(),clearTimeout(this.viewerState.resizeTimer)},this.settings.ID)}initPlugins(){if(!this.settings.hasOwnProperty("plugins"))return null;this.viewerState.pluginInstances=this.settings.plugins.map(e=>{let t=new e(this);return t.isPageTool&&this.viewerState.pageTools.push(t),t})}showThrobber(){this.hideThrobber(),this.viewerState.throbberTimeoutID=setTimeout(()=>{let e=document.getElementById(this.settings.selector+"throbber");e&&(e.style.display="block")},this.settings.throbberTimeout)}hideThrobber(){clearTimeout(this.viewerState.throbberTimeoutID);let e=document.getElementById(this.settings.selector+"throbber");e&&(e.style.display="none")}showError(e){let i=t("div",this.elemAttrs("error"),[t("button",this.elemAttrs("error-close",{"aria-label":"Close dialog"})),t("p",t("strong","Error")),t("div",e)]);this.viewerState.outerObject.appendChild(i),document.getElementById(this.settings.selector+"error-close").addEventListener("click",()=>{i.parentNode.removeChild(i)})}setManifest(e,i){let s,o;if(this.viewerState.manifest=e,this.hideThrobber(),this.viewerState.numPages=this.settings.manifest.pages.length,this.optionsValidator.validate(this.viewerState.options),this.publish("NumberOfPagesDidChange",this.settings.numPages),this.settings.adaptivePadding>0){let e=Math.floor((this.settings.minZoomLevel+this.settings.maxZoomLevel)/2);this.viewerState.horizontalPadding=Math.floor(this.settings.manifest.getAverageWidth(e)*this.settings.adaptivePadding),this.viewerState.verticalPadding=Math.floor(this.settings.manifest.getAverageHeight(e)*this.settings.adaptivePadding)}else this.viewerState.horizontalPadding=this.settings.fixedPadding,this.viewerState.verticalPadding=this.settings.fixedPadding;this.viewerState.pageTools.length&&(this.viewerState.verticalPadding=Math.max(40,this.viewerState.verticalPadding)),this.settings.manifest.paged&&(this.viewerState.options.inBookLayout=!0),this.publish("ObjectDidLoad",this.settings),this.updatePanelSize();let n=!1,r=!1;if(null==i.goDirectlyTo?(i.goDirectlyTo=this.settings.goDirectlyTo,s=o=!0):(s=null==i.horizontalOffset||isNaN(i.horizontalOffset),o=null==i.verticalOffset||isNaN(i.verticalOffset)),s&&(0===i.goDirectlyTo&&this.settings.inBookLayout&&this.settings.verticallyOriented?i.horizontalOffset=this.viewerState.horizontalPadding:(r=!0,i.horizontalOffset=this.getXOffset(i.goDirectlyTo,"center"))),o&&(n=!0,i.verticalOffset=this.getYOffset(i.goDirectlyTo,"top")),this.reloadViewer(i),this.updatePanelSize(),this.settings.enableAutoTitle){let e=document.getElementById(this.settings.selector+"title");e?e.innerHTML=this.settings.manifest.itemTitle:this.settings.parentObject.insertBefore(t("div",this.elemAttrs("title"),[this.settings.manifest.itemTitle]),this.settings.parentObject.firstChild)}this.settings.verticallyOriented?this.viewerState.innerElement.style.minWidth=this.settings.panelWidth+"px":this.viewerState.innerElement.style.minHeight=this.settings.panelHeight+"px",(n||r)&&(n&&(this.viewerState.verticalOffset=this.getYOffset(this.settings.activePageIndex,"top")),r&&(this.viewerState.horizontalOffset=this.getXOffset(this.settings.activePageIndex,"center")),this.viewerState.renderer.goto(this.settings.activePageIndex,this.viewerState.verticalOffset,this.viewerState.horizontalOffset)),this.viewerState.loaded=!0,this.publish("ViewerDidLoad",this.settings)}publish(e){for(var t=arguments.length,i=Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];a.Events.publish(e,i,this.publicInstance)}getSettings(){return this.settings}getInternalState(){return this.viewerState}getPublicInstance(){return this.publicInstance}getPageTools(){return this.viewerState.pageTools}getCurrentLayout(){return this.viewerState.renderer?this.viewerState.renderer.layout:null}getViewport(){let e=this.viewerState.viewport;return{top:e.top,left:e.left,bottom:e.bottom,right:e.right,width:e.width,height:e.height}}addPageOverlay(e){this.viewerState.pageOverlays.addOverlay(e)}removePageOverlay(e){this.viewerState.pageOverlays.removeOverlay(e)}getPageRegion(e,t){let i=this.viewerState.renderer.layout,s=i.getPageRegion(e,t);if(t&&t.incorporateViewport){let e=this.settings.verticallyOriented?"width":"height";if(this.viewerState.viewport[e]>i.dimensions[e]){let t=(this.viewerState.viewport[e]-i.dimensions[e])/2;return this.settings.verticallyOriented?{top:s.top,bottom:s.bottom,left:s.left+t,right:s.right+t}:{top:s.top+t,bottom:s.bottom+t,left:s.left,right:s.right}}}return s}getPagePositionAtViewportOffset(e){let t={left:e.left+this.viewerState.viewport.left,top:e.top+this.viewerState.viewport.top},i=this.viewerState.renderer,s=i.getRenderedPages(),o=s.length;for(let e=0;e<o;e++){let o=s[e],n=i.layout.getPageRegion(o);if(n.left<=t.left&&n.right>=t.left&&n.top<=t.top&&n.bottom>=t.top)return{anchorPage:o,offset:{left:t.left-n.left,top:t.top-n.top}}}let n=i.layout.getPageRegion(this.settings.activePageIndex);return{anchorPage:this.settings.activePageIndex,offset:{left:t.left-n.left,top:t.top-n.top}}}setCurrentPages(e,t){!function(e,t){if(e.length!==t.length)return!1;for(let i=0,s=e.length;i<s;i++)if(e[i]!==t[i])return!1;return!0}(this.viewerState.currentPageIndices,t)?(this.viewerState.currentPageIndices=t,this.viewerState.activePageIndex!==e&&(this.viewerState.activePageIndex=e,this.publish("ActivePageDidChange",e)),this.publish("VisiblePageDidChange",t),this.viewerState.manifest.pages[e].otherImages.length>0&&this.publish("VisiblePageHasAlternateViews",e)):this.viewerState.activePageIndex!==e&&(this.viewerState.activePageIndex=e,this.publish("ActivePageDidChange",e))}getPageName(e){return this.viewerState.manifest.pages[e].f}reload(e){return this.reloadViewer(e)}zoom(e,t){return this.handleZoom(e,t)}enableScrollable(){this.viewerState.isScrollable||(this.bindMouseEvents(),this.enableDragScrollable(),this.viewerState.options.enableKeyScroll=this.viewerState.initialKeyScroll,this.viewerState.options.enableSpaceScroll=this.viewerState.initialSpaceScroll,this.viewerState.viewportElement.style.overflow="auto",this.viewerState.isScrollable=!0)}enableDragScrollable(){this.viewerState.viewportObject.hasAttribute("nochilddrag")&&this.viewerState.viewportObject.removeAttribute("nochilddrag")}disableScrollable(){this.viewerState.isScrollable&&(this.disableDragScrollable(),this.viewerState.outerObject.ondblclick=null,this.viewerState.outerObject.oncontextmenu=null,this.viewerState.viewportElement.style.overflow="hidden",this.viewerState.initialKeyScroll=this.settings.enableKeyScroll,this.viewerState.initialSpaceScroll=this.settings.enableSpaceScroll,this.viewerState.options.enableKeyScroll=!1,this.viewerState.options.enableSpaceScroll=!1,this.viewerState.isScrollable=!1)}disableDragScrollable(){this.viewerState.viewportObject.hasAttribute("nochilddrag")||this.viewerState.viewportObject.setAttribute("nochilddrag","")}clear(){this.clearViewer()}setPendingManifestRequest(e){this.viewerState.pendingManifestRequest=e}destroy(){this.publish("ViewerWillTerminate",this.settings),this.settings.pendingManifestRequest&&this.settings.pendingManifestRequest.abort(),document.body.classList.remove("diva-hide-scrollbar"),this.settings.parentObject.parentElement.replaceChildren(),this.settings.parentObject.parentElement.removeAttribute("style"),this.settings.parentObject.parentElement.removeAttribute("class"),this.publish("ViewerDidTerminate",this.settings),a.Events.unsubscribeAll(this.settings.ID)}constructor(i,s,o){e(this,"parentObject",void 0),e(this,"publicInstance",void 0),e(this,"viewerState",void 0),e(this,"settings",void 0),e(this,"optionsValidator",void 0),e(this,"boundScrollFunction",void 0),e(this,"boundEscapeListener",void 0),this.parentObject=i,this.publicInstance=o,this.viewerState={currentPageIndices:[],activePageIndex:0,horizontalOffset:0,horizontalPadding:0,ID:null,initialKeyScroll:!1,initialSpaceScroll:!1,innerElement:null,innerObject:null,isActiveDiva:!0,isScrollable:!0,isZooming:!1,loaded:!1,manifest:null,mobileWebkit:!1,numPages:0,oldZoomLevel:-1,options:s,outerElement:null,outerObject:null,pageOverlays:new m,pageTools:[],parentObject:this.parentObject,pendingManifestRequest:null,pluginInstances:[],renderer:null,resizeTimer:null,scrollbarWidth:0,selector:"",throbberTimeoutID:null,toolbar:null,verticalOffset:0,verticalPadding:0,viewHandler:null,viewport:null,viewportElement:null,viewportObject:null,zoomDuration:400},this.settings=function(e){let t={};return e.forEach(e=>{(function(e,t){Object.keys(t).forEach(i=>{Object.defineProperty(e,i,{get:()=>t[i],set:()=>{throw TypeError("Cannot set settings."+i)}})})})(t,e)}),t}([s,this.viewerState]);let n=B();this.viewerState.ID="diva-"+n+"-",this.viewerState.selector=this.settings.ID,Object.defineProperties(this.settings,{panelHeight:{get:()=>this.viewerState.viewport.height},panelWidth:{get:()=>this.viewerState.viewport.width}}),this.optionsValidator=new z({additionalProperties:[{key:"manifest",get:()=>this.viewerState.manifest}],validations:G}),this.viewerState.scrollbarWidth=function(){let e=document.createElement("p");e.style.width="100%",e.style.height="200px";let t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);let i=e.offsetWidth;t.style.overflow="scroll";let s=e.offsetWidth;return i===s&&(s=t.clientWidth),document.body.removeChild(t),i-s}(),this.viewerState.mobileWebkit=void 0!==window.screen.orientation,null===s.hashParamSuffix&&(1===n?s.hashParamSuffix="":s.hashParamSuffix=n+"");let r=t("div",this.elemAttrs("inner",{class:"diva-inner"})),a=t("div",this.elemAttrs("viewport"),r),l=t("div",this.elemAttrs("outer"),a,t("div",this.elemAttrs("throbber"),[t("div",{class:"cube cube1"}),t("div",{class:"cube cube2"}),t("div",{class:"cube cube3"}),t("div",{class:"cube cube4"}),t("div",{class:"cube cube5"}),t("div",{class:"cube cube6"}),t("div",{class:"cube cube7"}),t("div",{class:"cube cube8"}),t("div",{class:"cube cube9"})]));this.viewerState.innerElement=r,this.viewerState.viewportElement=a,this.viewerState.outerElement=l,this.viewerState.innerObject=r,this.viewerState.viewportObject=a,this.viewerState.outerObject=l,this.settings.parentObject.append(l),this.viewerState.viewport=new k(this.viewerState.viewportElement,{intersectionTolerance:this.settings.viewportMargin}),this.boundScrollFunction=this.scrollFunction.bind(this),this.boundEscapeListener=this.escapeListener.bind(this),this.initPlugins(),this.handleEvents(),this.showThrobber()}}let W=(e,t)=>{let i=Math.max(e,t);return i<128?0:Math.ceil(Math.log((i+1)/257)/Math.log(2))},Y=(e,t)=>e/Math.pow(2,t),U=(e,t)=>e.map(e=>{let i=e.width,s=e.height,o=X(e),n="/"!==o.url.slice(-1)?o.url+"/":o.url,r=Array(t+1);for(let e=0;e<t+1;e++)r[e]={h:Math.floor(Y(s,t-e)),w:Math.floor(Y(i,t-e))};return{f:o.url,url:n,il:e.label||"",d:r}}),q=e=>"http://iiif.io/api/presentation/2/context.json"===e||Array.isArray(e)&&e.includes("http://iiif.io/api/presentation/2/context.json")?2:Array.isArray(e)&&e.includes("http://iiif.io/api/presentation/3/context.json")?3:2;function X(e){let t=e["@id"]||e.id,i=/#xywh=([0-9]+,[0-9]+,[0-9]+,[0-9]+)/,s="",o=!0;if(/\/([0-9]+,[0-9]+,[0-9]+,[0-9]+)\//.test(t)){let e=t.split("/");s=e[e.length-4]}else i.test(t)?s=i.exec(t)[1]:e.service&&(e.service["@id"]||e.service.id)&&(t=e.service["@id"]||e.service.id,o=!1);o&&(t=t.split("/").slice(0,-4).join("/"));let n={url:t};if(s.length){let e=s.split(",");n.x=parseInt(e[0],10),n.y=parseInt(e[1],10),n.w=parseInt(e[2],10),n.h=parseInt(e[3],10)}return n}class K{getPageImageURL(e,t,i){let s;s=i&&(null!=i.width||null!=i.height)?(null==i.width?"":i.width)+","+(null==i.height?"":i.height):"full";let o=e.pages[t],n=o.api>1.1?"default":"native";return encodeURI(o.url+"full/"+s+"/0/"+n+".jpg")}getTileImageURL(e,t,i){let s,o;let n=e.pages[t];s=i.row===i.rowCount-1?n.d[i.zoomLevel].h-(i.rowCount-1)*i.tileDimensions.height:i.tileDimensions.height,o=i.col===i.colCount-1?n.d[i.zoomLevel].w-(i.colCount-1)*i.tileDimensions.width:i.tileDimensions.width;let r=Math.pow(2,e.maxZoom-i.zoomLevel),a=i.col*i.tileDimensions.width*r,l=i.row*i.tileDimensions.height*r;n.hasOwnProperty("xoffset")&&(a+=n.xoffset,l+=n.yoffset);let h=[a,l,o*r,s*r].join(","),c=n.api>1.1?"default":"native";return encodeURI(n.url+h+"/"+o+","+s+"/0/"+c+".jpg")}}class ${static fromIIIF(e){return new $(function(e){let t,i,s,o,n=e["@context"]||null;if(!n)return console.error("Invalid IIIF Manifest; No @context found."),null;let r=q(n),a=e.sequences?e.sequences[0]:null,l=a?a.canvases:e.items,h=l.length,c=Array(l.length),d,g,u,v=[],p,m,f,w,_,b,y,P,S,C,L,x,O,E=100,I=0,D=100;for(let e=0;e<h;e++){let t=l[e],i=t.width,s=t.height,o=W(i,s),n=s/i;I=Math.max(n,I),D=Math.min(n,D),E=Math.min(E,o)}let T=Array(E+1).fill(0),M=Array(E+1).fill(0),z=Array(E+1).fill(0),V=Array(E+1).fill(0);for(let e=0;e<h;e++){if(P=(d=l[e])["@id"]||d.id,S=d.label,g=d.images?d.images[0].resource:d.items[0].items[0].body,v=[],"oa:Choice"===g["@type"]||"Choice"===g.type?(u=g.default||g.items[0],v=U(g.item||g.items.slice(1),E)):u=g,_=d.width||u.width,b=d.height||u.height,_<=0||b<=0){console.warn("Invalid width or height for canvas "+S+". Skipping");continue}y=W(_,b),C=u.label||null,m="/"!==(f=X(u)).url.slice(-1)?f.url+"/":f.url,w="http://iiif.io/api/image/2/context.json"===(p=u.service["@context"]||u.service.type)||"ImageService2"===p?2:"http://library.stanford.edu/iiif/image-api/1.1/context.json"===p?1.1:1,L=Array(E+1);for(let e=0;e<E+1;e++)x=Math.floor(Y(_,E-e)),O=Math.floor(Y(b,E-e)),L[e]={h:O,w:x},T[e]+=x,M[e]+=O,z[e]=Math.max(x,z[e]),V[e]=Math.max(O,V[e]);let t="non-paged"!==d.viewingHint||!!d.behavior&&"non-paged"!==d.behavior[0],i="facing-pages"===d.viewingHint||!!d.behavior&&"facing-pages"===d.behavior[0];c[e]={d:L,m:y,l:S,il:C,f:f.url,url:m,api:w,paged:t,facingPages:i,canvas:P,otherImages:v,xoffset:f.x||null,yoffset:f.y||null}}let F=Array(E+1).fill(0),k=Array(E+1).fill(0);for(let e=0;e<E+1;e++)F[e]=T[e]/h,k[e]=M[e]/h;let A={a_wid:F,a_hei:k,max_w:z,max_h:V,max_ratio:I,min_ratio:D,t_hei:M,t_wid:T};return{version:r,item_title:(s="object"==typeof(i=e.label)?i[Object.keys(i)[0]][0]:i,Array.isArray(t=Array.isArray(o=e.value)?o.map(e=>e[Object.keys(e)[0]]):"object"==typeof o?o[Object.keys(o)[0]]:o)&&(t=t.join(", ")),{label:s,value:t}).label,metadata:e.metadata||null,dims:A,max_zoom:E,pgs:c,paged:"paged"===e.viewingHint||!!e.behaviour&&"paged"===e.behaviour[0]||!!a&&"paged"===a.viewingHint}}(e),new K)}isPageValid(e,t){return(!!t||!this.paged||!!this.pages[e].paged)&&e>=0&&e<this.pages.length}getMaxPageDimensions(e){let t=this.pages[e].d[this.maxZoom];return{height:t.h,width:t.w}}getPageDimensionsAtZoomLevel(e,t){var i;let s=this.pages[e].d[this.maxZoom],o=(i=this.maxZoom,1/Math.pow(2,i-t));return{height:s.h*o,width:s.w*o}}getPageImageURL(e,t){return this._urlAdapter.getPageImageURL(this,e,t)}getPageImageTiles(e,t,i){let s,o,n;let r=this.pages[e];if(!isFinite(t)||t%1!=0)throw TypeError("Zoom level must be an integer: "+t);let a=Math.ceil(r.d[t].h/i.height),l=Math.ceil(r.d[t].w/i.width),h=[];for(s=0;s<a;s++)for(o=0;o<l;o++)n=this._urlAdapter.getTileImageURL(this,e,{row:s,col:o,rowCount:a,colCount:l,zoomLevel:t,tileDimensions:i}),h.push({row:s,col:o,zoomLevel:t,dimensions:{height:i.height,width:i.width},offset:{top:s*i.height,left:o*i.width},url:n});return{zoomLevel:t,rows:a,cols:l,tiles:h}}getAverageWidth(e){return this._averageWidths[e]}getAverageHeight(e){return this._averageHeights[e]}getMaxWidth(e){return this._maxWidths[e]}getMaxHeight(e){return this._maxHeights[e]}getTotalWidth(e){return this._totalWidths[e]}getTotalHeight(e){return this._totalHeights[e]}constructor(t,i){e(this,"pages",void 0),e(this,"maxZoom",void 0),e(this,"maxRatio",void 0),e(this,"minRatio",void 0),e(this,"itemTitle",void 0),e(this,"metadata",void 0),e(this,"paged",void 0),e(this,"_maxWidths",void 0),e(this,"_maxHeights",void 0),e(this,"_averageWidths",void 0),e(this,"_averageHeights",void 0),e(this,"_totalHeights",void 0),e(this,"_totalWidths",void 0),e(this,"_urlAdapter",void 0),this.pages=t.pgs,this.maxZoom=t.max_zoom,this.maxRatio=t.dims.max_ratio,this.minRatio=t.dims.min_ratio,this.itemTitle=t.item_title,this.metadata=t.metadata,this.paged=t.paged,this._maxWidths=t.dims.max_w,this._maxHeights=t.dims.max_h,this._averageWidths=t.dims.a_wid,this._averageHeights=t.dims.a_hei,this._totalHeights=t.dims.t_hei,this._totalWidths=t.dims.t_wid,this._urlAdapter=i}}class J{_elemAttrs(e,t){let i={id:this.settings.ID+e,class:"diva-"+e};return t?Object.assign(i,t):i}_subscribe(e,t){a.Events.subscribe(e,t,this.settings.ID)}createButton(e,i,s,o){let n=t("button",{type:"button",id:this.settings.ID+e,class:"diva-"+e+" diva-button",title:i,"aria-label":i});return o&&n.appendChild(o),s&&n.addEventListener("click",s),n}createLabel(e,i,s,o,n){return t("div",{id:this.settings.ID+i,class:e+" diva-label"},[s,t("span",{id:this.settings.ID+o},n)])}createZoomButtons(){let e=this._createZoomOutIcon(),i=this._createZoomInIcon(),s=[this.createButton("zoom-out-button","Zoom Out",()=>{this.viewer.setZoomLevel(this.settings.zoomLevel-1)},e),this.createButton("zoom-in-button","Zoom In",()=>{this.viewer.setZoomLevel(this.settings.zoomLevel+1)},i),this.createLabel("diva-zoom-label","zoom-label","Zoom level: ","zoom-level",this.settings.zoomLevel+1)],o=()=>{document.getElementById(this.settings.ID+"zoom-level").textContent=this.settings.zoomLevel+1};return this._subscribe("ZoomLevelDidChange",o),this._subscribe("ViewerDidLoad",o),t("div",{id:this.settings.ID+"zoom-controls",style:"display: none"},s)}createGridControls(){let e=this._createGridMoreIcon(),i=this._createGridFewerIcon(),s=[this.createButton("grid-out-button","Fewer",()=>{this.viewer.setGridPagesPerRow(this.settings.pagesPerRow-1)},i),this.createButton("grid-in-button","More",()=>{this.viewer.setGridPagesPerRow(this.settings.pagesPerRow+1)},e),this.createLabel("diva-grid-label","grid-label","Pages per row: ","pages-per-row",this.settings.pagesPerRow)];return this._subscribe("GridRowNumberDidChange",()=>{document.getElementById(this.settings.ID+"pages-per-row").textContent=this.settings.pagesPerRow}),t("div",{id:this.settings.ID+"grid-controls",style:"display:none"},s)}createPageLabel(){let e=t("span",{id:this.settings.ID+"current-page"}),i=()=>{let t=this.viewer.getCurrentPageIndices(),i=t[0],s=t[t.length-1],o=this.settings.manifest.pages[i].l,n=this.settings.manifest.pages[s].l;i!==s?this.settings.enableIndexAsLabel?e.textContent=i+" - "+s:e.textContent=o+" - "+n:this.settings.enableIndexAsLabel?e.textContent=i:e.textContent=o};return this._subscribe("VisiblePageDidChange",i),this._subscribe("ViewerDidLoad",i),this._subscribe("ViewDidSwitch",i),t("span",{class:"diva-page-label diva-label"},e)}createGotoPageForm(){let e=t("input",{id:this.settings.ID+"goto-page-input",class:"diva-input diva-goto-page-input",autocomplete:"off",type:"text","aria-label":"Page Input"}),i=t("input",{id:this.settings.ID+"goto-page-submit",class:"diva-button diva-button-text",type:"submit",value:"Go"}),s=t("div",{id:this.settings.ID+"input-suggestions",class:"diva-input-suggestions"}),o=t("form",{id:this.settings.ID+"goto-page",class:"diva-goto-form"},e,i,s);return o.addEventListener("submit",t=>{t.preventDefault();let i=e.value;if(this.settings.onGotoSubmit&&"function"==typeof this.settings.onGotoSubmit){let e=this.settings.onGotoSubmit(i);this.viewer.gotoPageByIndex(e)||window.alert("No page could be found with that label or page number")}else this.viewer.gotoPageByLabel(i)||window.alert("No page could be found with that label or page number");return s.style.display="none",!1}),["input","focus"].forEach(i=>{e.addEventListener(i,()=>{s.innerHTML="";let i=e.value,o=0;if(this.settings.enableGotoSuggestions&&i){let e=this.settings.manifest.pages;for(let n=0,r=e.length;n<r&&o<10;n++)if(e[n].l.toLowerCase().indexOf(i.toLowerCase())>-1){let i=t("div",{class:"diva-input-suggestion"},e[n].l);s.appendChild(i),o++}o>0&&(s.style.display="block")}else s.style.display="none"})}),e.addEventListener("keydown",t=>{let i;if("Enter"===t.code){let t=document.getElementsByClassName("active")[0];void 0!==t&&(e.value=t.innerText)}if("ArrowUp"===t.code){let e=(i=document.getElementsByClassName("active")[0])?i.previousSibling:void 0;if(void 0!==e)i.classList.remove("active"),null!==e&&e.classList.add("active");else{let e=document.getElementsByClassName("diva-input-suggestion").length-1;document.getElementsByClassName("diva-input-suggestion")[e].classList.add("active")}}else if("ArrowDown"===t.code){let e=(i=document.getElementsByClassName("active")[0])?i.nextSibling:void 0;void 0!==e?(i.classList.remove("active"),null!==e&&e.classList.add("active")):document.getElementsByClassName("diva-input-suggestion")[0].classList.add("active")}}),function(e,t,i,s){e.addEventListener(t,e=>{let t=e.target;for(;t&&t!==this;)t.matches(i)&&s.call(t,e),t=t.parentNode})}(s,"mousedown",".diva-input-suggestion",()=>{e.value=this.textContent,s.style.display="none";let t=new Event("submit",{cancelable:!0});o.dispatchEvent(t)}),e.addEventListener("blur",()=>{s.style.display="none"}),o}createViewMenu(){let e=t("div",this._elemAttrs("view-options")),i=this._createGridViewIcon(),s=this._createBookViewIcon(),o=this._createPageViewIcon(),n=this.createButton("view-icon","Change view",()=>{e.style.display="none"===e.style.display?"block":"none"}),r=t=>{this.viewer.changeView(t),e.style.display="none"},a=()=>{let t=" diva-view-icon diva-button";this.settings.inGrid?(n.appendChild(i),n.className="diva-grid-icon"+t):this.settings.inBookLayout?(n.appendChild(s),n.className="diva-book-icon"+t):(n.appendChild(o),n.className="diva-document-icon"+t);let a=document.createDocumentFragment();for((this.settings.inGrid||this.settings.inBookLayout)&&a.appendChild(this.createButton("document-icon","Document View",r.bind(null,"document"),o)),(this.settings.inGrid||!this.settings.inBookLayout)&&a.appendChild(this.createButton("book-icon","Book View",r.bind(null,"book"),s)),this.settings.inGrid||a.appendChild(this.createButton("grid-icon","Grid View",r.bind(null,"grid"),i));e.firstChild;)e.removeChild(e.firstChild);e.appendChild(a)};return document.addEventListener("mouseup",t=>{e!==t.target&&(e.style.display="none")}),this._subscribe("ViewDidSwitch",a),this._subscribe("ObjectDidLoad",a),t("div",this._elemAttrs("view-menu"),n,e)}createFullscreenButton(){let e=this._createFullscreenIcon();return this.createButton("fullscreen-icon","Toggle fullscreen mode",()=>{this.viewer.toggleFullscreenMode()},e)}toggleZoomGridControls(){this.settings.inGrid?(document.getElementById(this.settings.ID+"zoom-controls").style.display="none",document.getElementById(this.settings.ID+"grid-controls").style.display="block"):(document.getElementById(this.settings.ID+"zoom-controls").style.display="block",document.getElementById(this.settings.ID+"grid-controls").style.display="none")}render(){this._subscribe("ViewDidSwitch",this.toggleZoomGridControls),this._subscribe("ObjectDidLoad",this.toggleZoomGridControls);let e=[this.createZoomButtons(),this.createGridControls()],i=[this.createPageLabel(),this.createViewMenu()];this.settings.enableFullscreen&&i.push(this.createFullscreenButton()),this.settings.enableGotoPage&&i.splice(1,0,this.createGotoPageForm());let s=this.viewer.viewerState.pluginInstances;for(let t=0,n=s.length;t<n;t++){let n=s[t];if(n.toolbarSide)n.toolbarIcon=n.createIcon(),n.toolbarIcon&&("right"===n.toolbarSide?i.splice(2,0,n.toolbarIcon):"left"===n.toolbarSide&&e.splice(2,0,n.toolbarIcon),n.toolbarIcon.addEventListener("click",o.bind(this,n)))}function o(e){e.handleClick(this.viewer)}let n=t("div",this._elemAttrs("tools"),t("div",this._elemAttrs("tools-left"),e),t("div",this._elemAttrs("tools-right"),i));this.settings.toolbarParentObject.insertBefore(n,this.settings.toolbarParentObject.firstChild)}_createToolbarIcon(e){let t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttributeNS(null,"viewBox","0 0 25 25"),t.setAttributeNS(null,"x","0px"),t.setAttributeNS(null,"y","0px"),t.setAttributeNS(null,"style","enable-background:new 0 0 48 48;");let i=document.createElementNS("http://www.w3.org/2000/svg","g");return i.setAttributeNS(null,"transform","matrix(1, 0, 0, 1, -12, -12)"),e.forEach(e=>{let t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttributeNS(null,"d",e),i.appendChild(t)}),t.appendChild(i),t}_createZoomOutIcon(){return this._createToolbarIcon(["M19.5,23c-0.275,0-0.5-0.225-0.5-0.5v-1c0-0.275,0.225-0.5,0.5-0.5h7c0.275,0,0.5,0.225,0.5,0.5v1c0,0.275-0.225,0.5-0.5,0.5H19.5z","M37.219,34.257l-2.213,2.212c-0.202,0.202-0.534,0.202-0.736,0l-6.098-6.099c-1.537,0.993-3.362,1.577-5.323,1.577c-5.431,0-9.849-4.418-9.849-9.849c0-5.431,4.418-9.849,9.849-9.849c5.431,0,9.849,4.418,9.849,9.849c0,1.961-0.584,3.786-1.576,5.323l6.098,6.098C37.422,33.722,37.422,34.054,37.219,34.257z M29.568,22.099c0-3.706-3.014-6.72-6.72-6.72c-3.706,0-6.72,3.014-6.72,6.72c0,3.706,3.014,6.72,6.72,6.72C26.555,28.818,29.568,25.805,29.568,22.099z"])}_createZoomInIcon(){return this._createToolbarIcon(["M37.469,34.257l-2.213,2.212c-0.202,0.202-0.534,0.202-0.736,0l-6.098-6.099c-1.537,0.993-3.362,1.577-5.323,1.577c-5.431,0-9.849-4.418-9.849-9.849c0-5.431,4.418-9.849,9.849-9.849c5.431,0,9.849,4.418,9.849,9.849c0,1.961-0.584,3.786-1.576,5.323l6.098,6.098C37.672,33.722,37.672,34.054,37.469,34.257z M29.818,22.099c0-3.706-3.014-6.72-6.72-6.72c-3.706,0-6.72,3.014-6.72,6.72c0,3.706,3.014,6.72,6.72,6.72C26.805,28.818,29.818,25.805,29.818,22.099z M26.5,21H24v-2.5c0-0.275-0.225-0.5-0.5-0.5h-1c-0.275,0-0.5,0.225-0.5,0.5V21h-2.5c-0.275,0-0.5,0.225-0.5,0.5v1c0,0.275,0.225,0.5,0.5,0.5H22v2.5c0,0.275,0.225,0.5,0.5,0.5h1c0.275,0,0.5-0.225,0.5-0.5V23h2.5c0.275,0,0.5-0.225,0.5-0.5v-1C27,21.225,26.775,21,26.5,21z"])}_createGridMoreIcon(){return this._createToolbarIcon(["M29.5,35c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H29.5z M21.5,35c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H21.5z M13.5,35c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H13.5z M29.5,27c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H29.5z M21.5,27c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H21.5z M13.5,27c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H13.5z M29.5,19c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H29.5z M21.5,19c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H21.5z M13.5,19c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H13.5z"])}_createGridFewerIcon(){return this._createToolbarIcon(["M25.5,35c-0.275,0-0.5-0.225-0.5-0.5v-9c0-0.275,0.225-0.5,0.5-0.5h9c0.275,0,0.5,0.225,0.5,0.5v9c0,0.275-0.225,0.5-0.5,0.5H25.5z M22.5,35c0.275,0,0.5-0.225,0.5-0.5v-9c0-0.275-0.225-0.5-0.5-0.5h-9c-0.275,0-0.5,0.225-0.5,0.5v9c0,0.275,0.225,0.5,0.5,0.5H22.5z M34.5,23c0.275,0,0.5-0.225,0.5-0.5v-9c0-0.275-0.225-0.5-0.5-0.5h-9c-0.275,0-0.5,0.225-0.5,0.5v9c0,0.275,0.225,0.5,0.5,0.5H34.5z M22.5,23c0.275,0,0.5-0.225,0.5-0.5v-9c0-0.275-0.225-0.5-0.5-0.5h-9c-0.275,0-0.5,0.225-0.5,0.5v9c0,0.275,0.225,0.5,0.5,0.5H22.5z"])}_createGridViewIcon(){return this._createToolbarIcon(["M29.5,35c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H29.5z M21.5,35c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H21.5z M13.5,35c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H13.5z M29.5,27c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H29.5z M21.5,27c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H21.5z M13.5,27c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H13.5z M29.5,19c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H29.5z M21.5,19c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H21.5z M13.5,19c-0.275,0-0.5-0.225-0.5-0.5v-5c0-0.275,0.225-0.5,0.5-0.5h5c0.275,0,0.5,0.225,0.5,0.5v5c0,0.275-0.225,0.5-0.5,0.5H13.5z"])}_createBookViewIcon(){return this._createToolbarIcon(["M35,16.8v-1.323c0,0-2.292-1.328-5.74-1.328c-3.448,0-5.26,1.25-5.26,1.25s-1.813-1.25-5.26-1.25c-3.448,0-5.74,1.328-5.74,1.328V16.8l-1,0.531v0.021v15.687c0,0,4.531-1.578,6.999-1.578c2.468,0,5.001,0.885,5.001,0.885s2.532-0.885,5-0.885c0.306,0,0.643,0.024,1,0.066v4.325l1.531-2.016L33,35.852v-3.72c2,0.43,3,0.906,3,0.906V17.352v-0.021L35,16.8z M23,29.03c-1-0.292-2.584-0.679-3.981-0.679c-2.246,0-3.019,0.404-4.019,0.699V16.634c0,0,1.125-0.699,4.019-0.699c1.694,0,2.981,0.417,3.981,1.126V29.03z M33,29.051c-1-0.295-1.773-0.699-4.02-0.699c-1.396,0-2.981,0.387-3.98,0.679V17.06c1-0.709,2.286-1.126,3.98-1.126c2.895,0,4.02,0.699,4.02,0.699V29.051z"])}_createPageViewIcon(){return this._createToolbarIcon(["M29.425,29h4.47L29,33.934v-4.47C29,29.19,29.151,29,29.425,29z M34,14.563V28h-5.569C28.157,28,28,28.196,28,28.47V34H14.497C14.223,34,14,33.71,14,33.437V14.563C14,14.29,14.223,14,14.497,14h18.9C33.672,14,34,14.29,34,14.563z M25.497,26.497C25.497,26.223,25.275,26,25,26h-7c-0.275,0-0.497,0.223-0.497,0.497v1.006C17.503,27.777,17.725,28,18,28h7c0.275,0,0.497-0.223,0.497-0.497V26.497z M30.497,22.497C30.497,22.223,30.275,22,30,22H18c-0.275,0-0.497,0.223-0.497,0.497v1.006C17.503,23.777,17.725,24,18,24h12c0.275,0,0.497-0.223,0.497-0.497V22.497z M30.497,18.497C30.497,18.223,30.275,18,30,18H18c-0.275,0-0.497,0.223-0.497,0.497v1.006C17.503,19.777,17.725,20,18,20h12c0.275,0,0.497-0.223,0.497-0.497V18.497z"])}_createFullscreenIcon(){return this._createToolbarIcon(["M35,12H13c-0.55,0-1,0.45-1,1v22c0,0.55,0.45,1,1,1h22c0.55,0,1-0.45,1-1V13C36,12.45,35.55,12,35,12z M34,34H14V14h20V34z","M17,21.75v-4.5c0-0.138,0.112-0.25,0.25-0.25h4.5c0.138,0,0.17,0.08,0.073,0.177l-1.616,1.616l1.823,1.823c0.097,0.097,0.097,0.256,0,0.354l-1.061,1.06c-0.097,0.097-0.256,0.097-0.354,0l-1.823-1.823l-1.616,1.616C17.08,21.92,17,21.888,17,21.75z M20.97,25.97c-0.097-0.097-0.256-0.097-0.354,0l-1.823,1.823l-1.616-1.616C17.08,26.08,17,26.112,17,26.25v4.5c0,0.138,0.112,0.25,0.25,0.25h4.5c0.138,0,0.17-0.08,0.073-0.177l-1.616-1.616l1.823-1.823c0.097-0.097,0.097-0.256,0-0.354L20.97,25.97z M30.75,17h-4.5c-0.138,0-0.17,0.08-0.073,0.177l1.616,1.616l-1.823,1.823c-0.097,0.097-0.097,0.256,0,0.354l1.061,1.06c0.097,0.097,0.256,0.097,0.354,0l1.823-1.823l1.616,1.616C30.92,21.92,31,21.888,31,21.75v-4.5C31,17.112,30.888,17,30.75,17z M30.823,26.177l-1.616,1.616l-1.823-1.823c-0.097-0.097-0.256-0.097-0.354,0l-1.061,1.06c-0.097,0.097-0.097,0.256,0,0.354l1.823,1.823l-1.616,1.616C26.08,30.92,26.112,31,26.25,31h4.5c0.138,0,0.25-0.112,0.25-0.25v-4.5C31,26.112,30.92,26.08,30.823,26.177z M26,22.5c0-0.275-0.225-0.5-0.5-0.5h-3c-0.275,0-0.5,0.225-0.5,0.5v3c0,0.275,0.225,0.5,0.5,0.5h3c0.275,0,0.5-0.225,0.5-0.5V22.5z"])}constructor(t){e(this,"settings",void 0),e(this,"viewer",void 0),this.viewer=t,this.settings=t.settings}}let Q={get:function(e){let t=window.location.hash;if(""===t)return!1;{let i=t.indexOf("&"+e+"=")>0?t.indexOf("&"+e+"="):t.indexOf("#"+e+"=");if(!(i>=0))return!1;{i+=e.length+2;let s=t.indexOf("&",i);return s>i?decodeURIComponent(t.substring(i,s)):s<0?decodeURIComponent(t.substring(i)):""}}}};class ee{_loadOrFetchObjectData(){if("object"==typeof this.settings.objectData)setTimeout(()=>{this._loadObjectData(this.settings.objectData,this.hashState)},0);else{let e=fetch(this.settings.objectData,{headers:this.settings.requestHeaders}).then(e=>{if(!e.ok){a.Events.publish("ManifestFetchError",[e],this),this._ajaxError(e);let t=Error(e.statusText);throw t.response=e,t}return e.json()}).then(e=>{this._loadObjectData(e,this.hashState)});this.divaState.viewerCore.setPendingManifestRequest(e)}}_showError(e){this.divaState.viewerCore.showError(e)}_ajaxError(e){let i=["Invalid objectData setting. Error code: "+e.status+" "+e.statusText];if(0===this.settings.objectData.lastIndexOf("http",0)){let e=this.settings.objectData.replace(/https?:\/\//i,"").split(/[/?#]/)[0];window.location.hostname!==e&&i.push(t("p","Attempted to access cross-origin data without CORS."),t("p","You may need to update your server configuration to support CORS. For help, see the ",t("a",{href:"https://github.com/DDMAL/diva.js/wiki/Installation#a-note-about-cross-site-requests",target:"_blank"},"cross-site request documentation.")))}this._showError(i)}_loadObjectData(e,t){let i;if(!e.hasOwnProperty("@context")&&(-1===e["@context"].indexOf("iiif")||-1===e["@context"].indexOf("shared-canvas")))throw new n("This does not appear to be a IIIF Manifest.");a.Events.publish("ManifestDidLoad",[e],this),i=$.fromIIIF(e);let s=t?this._getLoadOptionsForState(t,i):{};this.divaState.viewerCore.setManifest(i,s)}_getHashParamState(){let e={};return["f","v","z","n","i","p","y","x"].forEach(t=>{let i=Q.get(t+this.settings.hashParamSuffix);!1!==i&&(e[t]=i)}),"true"===e.f?e.f=!0:"false"===e.f&&(e.f=!1),["z","n","p","x","y"].forEach(t=>{t in e&&(e[t]=parseInt(e[t],10))}),e}_getLoadOptionsForState(e,t){t=t||this.settings.manifest;let i="v"in e?this._getViewState(e.v):{};"f"in e&&(i.inFullscreen=e.f),"z"in e&&(i.zoomLevel=e.z),"n"in e&&(i.pagesPerRow=e.n);let s=this._getPageIndexForManifest(t,e.i);if(s>=0&&s<t.pages.length||(s=e.p-1)>=0&&s<t.pages.length||(s=-1),s>=0){let t=parseInt(e.x,10),o=parseInt(e.y,10);i.goDirectlyTo=s,i.horizontalOffset=t,i.verticalOffset=o}return i}_getViewState(e){switch(e){case"d":return{inGrid:!1,inBookLayout:!1};case"b":return{inGrid:!1,inBookLayout:!0};case"g":return{inGrid:!0,inBookLayout:!1};default:return{}}}_getPageIndexForManifest(e,t){let i=e.pages.length;for(let s=0;s<i;s++)if(e.pages[s].f===t)return s;return -1}_getState(){let e;e=this.settings.inGrid?"g":this.settings.inBookLayout?"b":"d";let t=this.divaState.viewerCore.getCurrentLayout().getPageToViewportCenterOffset(this.settings.activePageIndex,this.viewerState.viewport);return{f:this.settings.inFullscreen,v:e,z:this.settings.zoomLevel,n:this.settings.pagesPerRow,i:!!this.settings.enableFilename&&this.settings.manifest.pages[this.settings.activePageIndex].f,p:!this.settings.enableFilename&&this.settings.activePageIndex+1,y:t?t.y:0,x:t?t.x:0}}_getURLHash(){let e=this._getState(),t=[];for(let i in e)!1!==e[i]&&t.push(i+this.settings.hashParamSuffix+"="+encodeURIComponent(e[i]));return t.join("&")}_getPageIndex(e){return this._getPageIndexForManifest(this.settings.manifest,e)}_checkLoaded(){return!!this.viewerState.loaded||(console.warn("The viewer is not completely initialized. This is likely because it is still downloading data. To fix this, only call this function if the isReady() method returns true."),!1)}_toggleFullscreen(){let e;this._reloadViewer({inFullscreen:!this.settings.inFullscreen});let t=!1,i=document.getElementById(this.settings.selector+"tools");function s(){i.style.opacity="1",clearTimeout(e),!t&&this.settings.inFullscreen&&(e=setTimeout(function(){i.style.opacity="0"},2e3))}i&&(this.settings.inFullscreen?(i.classList.add("diva-fullscreen-tools"),document.addEventListener("mousemove",s.bind(this)),document.getElementsByClassName("diva-viewport")[0].addEventListener("scroll",s.bind(this)),i.addEventListener("mouseenter",function(){t=!0}),i.addEventListener("mouseleave",function(){t=!1})):i.classList.remove("diva-fullscreen-tools"))}_togglePageLayoutOrientation(){let e=!this.settings.verticallyOriented;return this._reloadViewer({inGrid:!1,verticallyOriented:e,goDirectlyTo:this.settings.activePageIndex,verticalOffset:this.divaState.viewerCore.getYOffset(),horizontalOffset:this.divaState.viewerCore.getXOffset()}),e}_changeView(e){switch(e){case"document":return this._reloadViewer({inGrid:!1,inBookLayout:!1});case"book":return this._reloadViewer({inGrid:!1,inBookLayout:!0});case"grid":return this._reloadViewer({inGrid:!0});default:return!1}}_gotoPageByIndex(e,t,i){if(this._isPageIndexValid(e)){let s=this.divaState.viewerCore.getXOffset(e,t),o=this.divaState.viewerCore.getYOffset(e,i);return this.viewerState.renderer.goto(e,o,s),!0}return!1}_isPageIndexValid(e){return this.settings.manifest.isPageValid(e,this.settings.showNonPagedPages)}_getPageIndexForPageXYValues(e,t){let i=this.viewerState.outerElement.getBoundingClientRect(),s=i.top,o=i.left,n=i.bottom,r=i.right;if(e<o||e>r||t<s||t>n)return -1;let a=document.getElementsByClassName("diva-page"),l=a.length;for(;l--;){let i=a[l],s=i.getBoundingClientRect();if(!(e<s.left)&&!(e>s.right)&&!(t<s.top)&&!(t>s.bottom))return parseInt(i.getAttribute("data-index"),10)}return -1}_reloadViewer(e){return this.divaState.viewerCore.reload(e)}_getCurrentURL(){return location.protocol+"//"+location.host+location.pathname+location.search+"#"+this._getURLHash()}activate(){this.viewerState.isActiveDiva=!0}changeObject(e){this.viewerState.loaded=!1,this.divaState.viewerCore.clear(),this.viewerState.renderer&&this.viewerState.renderer.destroy(),this.viewerState.options.objectData=e,this._loadOrFetchObjectData()}changeView(e){return this._changeView(e)}deactivate(){this.viewerState.isActiveDiva=!1}destroy(){this.divaState.viewerCore.destroy()}disableScrollable(){this.divaState.viewerCore.disableScrollable()}enableScrollable(){this.divaState.viewerCore.enableScrollable()}disableDragScrollable(){this.divaState.viewerCore.disableDragScrollable()}enableDragScrollable(){this.divaState.viewerCore.enableDragScrollable()}enterFullscreenMode(){return!this.settings.inFullscreen&&(this._toggleFullscreen(),!0)}enterGridView(){return!this.settings.inGrid&&(this._changeView("grid"),!0)}getAllPageURIs(){return this.settings.manifest.pages.map(e=>e.f)}getCurrentCanvas(){return this.settings.manifest.pages[this.settings.activePageIndex].canvas}getCurrentCanvasLabel(){return this.settings.manifest.pages[this.settings.activePageIndex].l}getCurrentPageDimensionsAtCurrentZoomLevel(){return this.getPageDimensionsAtCurrentZoomLevel(this.settings.activePageIndex)}getCurrentPageIndices(){return this.settings.currentPageIndices}getActivePageIndex(){return this.settings.activePageIndex}getCurrentPageOffset(){return this.getPageOffset(this.settings.activePageIndex)}getCurrentPageURI(){return this.settings.manifest.pages[this.settings.activePageIndex].f}getCurrentURL(){return this._getCurrentURL()}getGridPagesPerRow(){return this.settings.pagesPerRow}getInstanceId(){return this.settings.ID}getInstanceSelector(){return this.divaState.viewerCore.viewerState.selector}getItemTitle(){return this.settings.manifest.itemTitle}getMaxZoomLevel(){return this.settings.maxZoomLevel}getMaxZoomLevelForPage(e){return this._checkLoaded()?this.settings.manifest.pages[e].m:null}getMinZoomLevel(){return this.settings.minZoomLevel}getNumberOfPages(){return!!this._checkLoaded()&&this.settings.numPages}getOtherImages(e){return this.settings.manifest.pages[e].otherImages}getPageDimensions(e){return this._checkLoaded()?this.divaState.viewerCore.getCurrentLayout().getPageDimensions(e):null}getPageDimensionsAtCurrentZoomLevel(e){if(!this._isPageIndexValid(e))throw Error("Invalid Page Index");return this.divaState.viewerCore.getCurrentLayout().getPageDimensions(e)}getPageDimensionsAtZoomLevel(e,t){if(!this._checkLoaded())return null;t>this.settings.maxZoomLevel&&(t=this.settings.maxZoomLevel);let i=this.settings.manifest.pages[e].d[t];return{width:i.w,height:i.h}}getPageImageURL(e,t){return this.settings.manifest.getPageImageURL(e,t)}getPageIndexForPageXYValues(e,t){return this._getPageIndexForPageXYValues(e,t)}getPageOffset(e,t){let i=this.divaState.viewerCore.getPageRegion(e,t);return{top:i.top,left:i.left}}getSettings(){return this.settings}getState(){return this._getState()}getZoomLevel(){return this.settings.zoomLevel}gotoPageByIndex(e,t,i){return this._gotoPageByIndex(e,t,i)}gotoPageByLabel(e,t,i){let s=this.settings.manifest.pages,o=e.toLowerCase();for(let e=0,n=s.length;e<n;e++)if(s[e].l.toLowerCase().indexOf(o)>-1)return this._gotoPageByIndex(e,t,i);let n=parseInt(e,10)-1;return this._gotoPageByIndex(n,t,i)}gotoPageByURI(e,t,i){let s=this._getPageIndex(e);return this._gotoPageByIndex(s,t,i)}hasOtherImages(e){return!0===this.settings.manifest.pages[e].otherImages}hideNonPagedPages(){this._reloadViewer({showNonPagedPages:!1})}isInFullscreen(){return this.settings.inFullscreen}isPageIndexValid(e){return this._isPageIndexValid(e)}isPageInViewport(e){return this.viewerState.renderer.isPageVisible(e)}isReady(){return this.viewerState.loaded}isRegionInViewport(e,t,i,s,o){let n=this.divaState.viewerCore.getCurrentLayout();if(!n)return!1;let r=n.getPageOffset(e),a=r.top+i,l=r.left+t;return this.viewerState.viewport.intersectsRegion({top:a,bottom:a+o,left:l,right:l+s})}isVerticallyOriented(){return this.settings.verticallyOriented}leaveFullscreenMode(){return!!this.settings.inFullscreen&&(this._toggleFullscreen(),!0)}leaveGridView(){return!!this.settings.inGrid&&(this._reloadViewer({inGrid:!1}),!0)}setGridPagesPerRow(e){return!!this.divaState.viewerCore.isValidOption("pagesPerRow",e)&&this._reloadViewer({inGrid:!0,pagesPerRow:e})}setState(e){return this._reloadViewer(this._getLoadOptionsForState(e))}setZoomLevel(e){return this.settings.inGrid&&this._reloadViewer({inGrid:!1}),this.divaState.viewerCore.zoom(e)}showNonPagedPages(){return this._reloadViewer({showNonPagedPages:!0})}toggleFullscreenMode(){this._toggleFullscreen()}toggleNonPagedPagesVisibility(){return this._reloadViewer({showNonPagedPages:!this.settings.showNonPagedPages})}toggleOrientation(){return this._togglePageLayoutOrientation()}translateFromMaxZoomLevel(e){return e/Math.pow(2,this.settings.maxZoomLevel-this.settings.zoomLevel)}translateToMaxZoomLevel(e){let t=this.settings.maxZoomLevel-this.settings.zoomLevel;return 0===t?e:e*Math.pow(2,t)}zoomIn(){return this.setZoomLevel(this.settings.zoomLevel+1)}zoomOut(){return this.setZoomLevel(this.settings.zoomLevel-1)}constructor(i,s){if(e(this,"element",void 0),e(this,"options",void 0),e(this,"viewerState",void 0),e(this,"settings",void 0),e(this,"toolbar",void 0),e(this,"hashState",void 0),e(this,"divaState",void 0),!(i instanceof HTMLElement)&&(this.element=document.getElementById(i),null===this.element))throw new o("The parent element was not found.");if(!s.objectData)throw new r("You must supply either a URL or a literal object to the `objectData` key.");this.options=Object.assign({adaptivePadding:.05,arrowScrollAmount:40,blockMobileMove:!1,objectData:"",enableAutoTitle:!0,enableFilename:!0,enableFullscreen:!0,enableGotoPage:!0,enableGotoSuggestions:!0,enableGridIcon:!0,enableGridControls:"buttons",enableImageTitles:!0,enableIndexAsLabel:!1,enableKeyScroll:!0,enableLinkIcon:!0,enableNonPagedVisibilityIcon:!0,enableSpaceScroll:!1,enableToolbar:!0,enableZoomControls:"buttons",fillParentHeight:!0,fixedPadding:10,fixedHeightGrid:!0,goDirectlyTo:0,hashParamSuffix:null,imageCrossOrigin:"anonymous",inFullscreen:!1,inBookLayout:!1,inGrid:!1,maxPagesPerRow:8,maxZoomLevel:-1,minPagesPerRow:2,minZoomLevel:0,onGotoSubmit:null,pageAliases:{},pageAliasFunction:function(){return!1},pageLoadTimeout:200,pagesPerRow:5,requestHeaders:{Accept:"application/json"},showNonPagedPages:!1,throbberTimeout:100,tileHeight:256,tileWidth:256,toolbarParentObject:null,verticallyOriented:!0,viewportMargin:200,zoomLevel:2},s);let n=t("div",{class:`diva-wrapper${this.options.fillParentHeight?" diva-wrapper-flexbox":""}`});this.element.appendChild(n),this.options.toolbarParentObject=this.options.toolbarParentObject||n;let l=new N(n,this.options,this);this.viewerState=l.getInternalState(),this.settings=l.getSettings(),this.toolbar=this.settings.enableToolbar?new J(this):null,n.id=this.settings.ID+"wrapper",this.divaState={viewerCore:l,toolbar:this.toolbar};let h=a.Events.subscribe("ObjectDidLoad",()=>{null!==this.toolbar&&this.toolbar.render(),a.Events.unsubscribe(h)});this.hashState=this._getHashParamState(),this._loadOrFetchObjectData()}}ee.Events=a.Events,"undefined"!=typeof window&&function(e){e.Diva=e.Diva||ee}(window)})()})();